<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="v1.4.0, Sep 28, 2015">
<title>Docker for Java Developers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article">
<div id="header">
<h1>Docker for Java Developers</h1>
<div class="details">
<span id="author" class="author">v1.4.0, Sep 28, 2015</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Latest HTML:
<a href="https://htmlpreview.github.io/?https://github.com/redhat-developer/docker-java/blob/javaone2015/readme.html" class="bare">https://htmlpreview.github.io/?https://github.com/redhat-developer/docker-java/blob/javaone2015/readme.html</a></p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">1. Preface</a></li>
<li><a href="#_setup_environments">2. Setup Environments</a>
<ul class="sectlevel2">
<li><a href="#_hardware">2.1. Hardware</a></li>
<li><a href="#_environment_just_needed_if_you_are_running_with_instructor_support">2.2. Environment (Just needed if you are running with Instructor support)</a>
<ul class="sectlevel3">
<li><a href="#_dns_server_setup_windows">2.2.1. DNS Server setup Windows</a></li>
<li><a href="#_dns_server_setup_linux_mac_os">2.2.2. DNS Server setup Linux/Mac OS</a></li>
</ul>
</li>
<li><a href="#_software">2.3. Software</a></li>
<li><a href="#_git_client">2.4. Git Client</a></li>
<li><a href="#_maven">2.5. Maven</a></li>
<li><a href="#_virtualbox">2.6. VirtualBox</a></li>
<li><a href="#_vagrant">2.7. Vagrant</a></li>
<li><a href="#_docker_machine">2.8. Docker Machine</a></li>
<li><a href="#_create_lab_docker_host">2.9. Create Lab Docker Host</a></li>
<li><a href="#_docker_client">2.10. Docker Client</a></li>
<li><a href="#_wildfly">2.11. WildFly</a></li>
<li><a href="#_jboss_developer_studio_9_0_0_ga">2.12. JBoss Developer Studio 9.0.0.GA</a></li>
</ul>
</li>
<li><a href="#_docker_basics">3. Docker Basics</a>
<ul class="sectlevel2">
<li><a href="#_docker_machine_2">3.1. Docker Machine</a></li>
<li><a href="#_docker_client_2">3.2. Docker Client</a></li>
<li><a href="#_verify_docker_configuration">3.3. Verify Docker Configuration</a></li>
</ul>
</li>
<li><a href="#_run_container">4. Run Container</a>
<ul class="sectlevel2">
<li><a href="#_pull_image">4.1. Pull Image</a></li>
<li><a href="#_run_container_2">4.2. Run Container</a>
<ul class="sectlevel3">
<li><a href="#_interactive_container">4.2.1. Interactive Container</a></li>
<li><a href="#_detached_container">4.2.2. Detached Container</a></li>
</ul>
</li>
<li><a href="#_run_container_with_default_port">4.3. Run Container with Default Port</a></li>
<li><a href="#_run_container_with_specified_port">4.4. Run Container with Specified Port</a></li>
<li><a href="#Enabling_WildFly_Administration">4.5. Enabling WildFly Administration</a>
<ul class="sectlevel3">
<li><a href="#_default_port_mapping">4.5.1. Default Port Mapping</a></li>
<li><a href="#Management_Fixed_Port_Mapping">4.5.2. Fixed Port Mapping</a></li>
</ul>
</li>
<li><a href="#_stop_and_remove_container">4.6. Stop and Remove Container</a>
<ul class="sectlevel3">
<li><a href="#_stop_container">4.6.1. Stop Container</a></li>
<li><a href="#_remove_container">4.6.2. Remove Container</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#JavaEE7_PreBuilt_WAR">5. Deploy Java EE 7 Application (Pre-Built WAR)</a></li>
<li><a href="#JavaEE7_Container_Linking">6. Deploy Java EE 7 Application (Container Linking)</a></li>
<li><a href="#_build_and_deploy_java_ee_7_application">7. Build and Deploy Java EE 7 Application</a>
<ul class="sectlevel2">
<li><a href="#Build_Application">7.1. Build Application</a></li>
<li><a href="#_start_application_server">7.2. Start Application Server</a></li>
<li><a href="#_configure_jboss_developer_studio">7.3. Configure JBoss Developer Studio</a></li>
<li><a href="#_deploy_application_using_shared_volumes">7.4. Deploy Application Using Shared Volumes</a></li>
<li><a href="#_deploy_application_using_cli">7.5. Deploy Application Using CLI</a></li>
<li><a href="#_deploy_application_using_web_console">7.6. Deploy Application Using Web Console</a></li>
<li><a href="#_deploy_application_using_management_api">7.7. Deploy Application Using Management API</a></li>
</ul>
</li>
<li><a href="#Docker_Compose">8. Multiple Containers Using Docker Compose</a>
<ul class="sectlevel2">
<li><a href="#_install_docker_compose">8.1. Install docker compose</a></li>
<li><a href="#_configuration_file">8.2. Configuration File</a></li>
<li><a href="#_start_services">8.3. Start Services</a></li>
<li><a href="#_verify_application">8.4. Verify Application</a></li>
<li><a href="#_scale_services">8.5. Scale Services</a></li>
<li><a href="#_stop_services">8.6. Stop Services</a></li>
<li><a href="#_remove_containers">8.7. Remove Containers</a></li>
</ul>
</li>
<li><a href="#Docker_Swarm">9. Java EE Application on Docker Swarm Cluster</a>
<ul class="sectlevel2">
<li><a href="#_key_components_of_docker_swarm">9.1. Key Components of Docker Swarm</a></li>
<li><a href="#_create_a_docker_swarm_cluster">9.2. Create a Docker Swarm Cluster</a></li>
<li><a href="#_deploy_java_ee_application_to_docker_swarm_cluster">9.3. Deploy Java EE Application to Docker Swarm Cluster</a></li>
<li><a href="#_deploy_java_ee_application_to_docker_swarm_cluster_using_docker_compose">9.4. Deploy Java EE Application to Docker Swarm Cluster using Docker Compose</a></li>
</ul>
</li>
<li><a href="#Common_Docker_Commands">10. Common Docker Commands</a></li>
<li><a href="#_troubleshooting">11. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_can_t_resolve_classroom_example_com">11.1. Can&#8217;t resolve classroom.example.com</a></li>
<li><a href="#_network_timed_out">11.2. Network Timed Out</a>
<ul class="sectlevel3">
<li><a href="#_restart_docker_machine">11.2.1. Restart Docker Machine</a></li>
<li><a href="#_loading_images_offline">11.2.2. Loading Images Offline</a></li>
</ul>
</li>
<li><a href="#_cannot_create_docker_machine_on_windows">11.3. Cannot create Docker Machine on Windows</a></li>
<li><a href="#_no_route_to_host">11.4. No route to host</a></li>
</ul>
</li>
<li><a href="#_references">12. References</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface">1. Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Containers are enabling developers to package their applications (and underlying dependencies) in new ways that are portable and work consistently everywhere? On your machine, in production, in your data center, and in the cloud. And Docker has become the de facto standard for those portable containers in the cloud.</p>
</div>
<div class="paragraph">
<p>Docker is the developer-friendly Linux container technology that enables creation of your stack: OS, JVM, app server, app, and all your custom configuration. So with all it offers, how comfortable are you and your team taking Docker from development to production? Are you hearing developers say, “But it works on my machine!” when code breaks in production?</p>
</div>
<div class="paragraph">
<p>This lab offers developers an intro-level, hands-on session with Docker, from installation, to exploring Docker Hub, to crafting their own images, to adding Java apps and running custom containers. It will also explain how to use Swarm to orchesorchestrate these containers together. This is a BYOL (bring your own laptop) session, so bring your Windows, OSX, or Linux laptop and be ready to dig into a tool that promises to be at the forefront of our industry for some time to come.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Latest content of this lab is always at <a href="https://github.com/redhat-developer/docker-java" class="bare">https://github.com/redhat-developer/docker-java</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_environments">2. Setup Environments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes what, how, and where to install the software needed for this lab. This lab is designed for a BYOL (Brying Your Own Laptop) style hands-on-lab.</p>
</div>
<div class="sect2">
<h3 id="_hardware">2.1. Hardware</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Operating System: Mac OS X (10.8 or later), Windows 7 (SP1), Fedora (21 or later)</p>
</li>
<li>
<p>Memory: At least 4 GB+, preferred 8 GB</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_environment_just_needed_if_you_are_running_with_instructor_support">2.2. Environment (Just needed if you are running with Instructor support)</h3>
<div class="sect3">
<h4 id="_dns_server_setup_windows">2.2.1. DNS Server setup Windows</h4>
<div class="paragraph">
<p>Go to the adapter settings of your pc&#8217;s and open the Wireless Network Connection Properties Dialogue. Edit the IPv4 Properties and add the instructor IP (!) as a primary DNS server.</p>
</div>
<div id="Figure1-3" class="imageblock">
<div class="content">
<img src="chapters/images/dns-setup-3.png" alt="Attendee DNS Setup">
</div>
<div class="title">Figure 1. Attendee DNS setup</div>
</div>
<div class="paragraph">
<p>Switch to the cmd and ping classroom.example.com to verify it works.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dns_server_setup_linux_mac_os">2.2.2. DNS Server setup Linux/Mac OS</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <code>/etc/resolv.conf</code> (Mac OS or Linux) and leave it as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">nameserver &lt;INSTRUCTOR IP ADDRESS&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_software">2.3. Software</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Java: <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Oracle JDK 8u45</a></p>
</li>
<li>
<p>Web Browser</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="https://www.google.com/chrome/browser/desktop/">Chrome</a></p>
</li>
<li>
<p><a href="http://www.getfirefox.com">Firefox</a></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_git_client">2.4. Git Client</h3>
<div class="paragraph">
<p>Install Git Client as explained at: <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" class="bare">https://git-scm.com/book/en/v2/Getting-Started-Installing-Git</a></p>
</div>
<div class="paragraph">
<p>You can find GIT for Windows at: <a href="http://classroom.example.com:8082/downloads/Git-1.9.5-preview20150319.exe" class="bare">http://classroom.example.com:8082/downloads/Git-1.9.5-preview20150319.exe</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_maven">2.5. Maven</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download Apache Maven&#8230;&#8203;</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>from Internet: <a href="https://maven.apache.org/download.cgi" class="bare">https://maven.apache.org/download.cgi</a></p>
</li>
<li>
<p>from Instructor: <a href="http://classroom.example.com:8082/downloads/apache-maven-3.3.3-bin.zip" class="bare">http://classroom.example.com:8082/downloads/apache-maven-3.3.3-bin.zip</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Unzip to a directory of your choice and add it to the <code>PATH</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_virtualbox">2.6. VirtualBox</h3>
<div class="paragraph">
<p>Docker currently runs natively on Linux. It can be configured to run in a virtual machine on Mac or Windows. This is why Virtualbox is a requirement for Mac or Windows.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Downloads are available</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>from Internet: <a href="https://www.virtualbox.org/wiki/Downloads" class="bare">https://www.virtualbox.org/wiki/Downloads</a> .</p>
</li>
<li>
<p>from Instructor: <a href="http://classroom.example.com:8082/downloads/virtualbox/" class="bare">http://classroom.example.com:8082/downloads/virtualbox/</a> .</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Linux Users</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have your kernel updated</p>
</li>
<li>
<p>Users should have the GNU compiler, build and header files for your current Linux kernel</p>
</li>
<li>
<p>Create a <code>/usr/src/linux</code> link to the current kernel source</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_vagrant">2.7. Vagrant</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download Vagrant</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>from Internet: <a href="https://www.vagrantup.com/downloads.html" class="bare">https://www.vagrantup.com/downloads.html</a></p>
</li>
<li>
<p>from Instructor: <a href="http://classroom.example.com:8082/downloads/vagrant/" class="bare">http://classroom.example.com:8082/downloads/vagrant/</a>
and install.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_docker_machine">2.8. Docker Machine</h3>
<div class="paragraph">
<p>Docker Machine makes it really easy to create Docker hosts on your computer, on cloud providers and inside your own data center. It creates servers, installs Docker on them, then configures the Docker client to talk to them.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#Windows - From Internet
curl https://github.com/docker/machine/releases/download/v0.4.1/docker-machine.exe

#Windows - From Instructor
curl http://classroom.example.com:8082/downloads/docker/docker-machine.exe

# Linux - From Internet
sudo curl -L  https://github.com/docker/machine/releases/download/v0.4.1/docker-machine_linux-amd64  -o /usr/local/bin/docker-machine
sudo chmod +x /usr/local/bin/docker-machine

# Linux - From Instructor
sudo curl -L  http://classroom.example.com:8082/downloads/docker/docker-machine_linux-amd64 -o /usr/local/bin/docker-machine
sudo chmod +x /usr/local/bin/docker-machine

# Mac - From Internet
sudo curl -L https://github.com/docker/machine/releases/download/v0.4.1/docker-machine_darwin-amd64 -o /usr/local/bin/docker-machine
sudo chmod +x /usr/local/bin/docker-machine

# Mac - From Instructor
sudo curl -L http://classroom.example.com:8082/downloads/docker/docker-machine_darwin-amd64 -o /usr/local/bin/docker-machine
sudo chmod +x /usr/local/bin/docker-machine</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_lab_docker_host">2.9. Create Lab Docker Host</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are running this lab without an Instructor, create the Docker Host using the following command:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker-machine create --driver=virtualbox lab
eval "$(docker-machine env lab)"</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Or Create Docker Host to be used in the lab with an Instructor:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>docker-machine create --driver=virtualbox --virtualbox-boot2docker-url=http://classroom.example.com:8082/downloads/boot2docker.iso --engine-insecure-registry=classroom.example.com:5000 lab

eval "$(docker-machine env lab)"</pre>
</div>
</div>
<div class="paragraph">
<p>Use the following command on Windows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker-machine env lab --shell cmd</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then execute all the <code>set</code> commands.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To make it easier to start/stop the containers, an entry is added into the host mapping table of your operating system. Find out the IP address of your machine:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker-machine ip lab</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will provide the IP address associated with the Docker Machine created earlier.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <code>C:\Windows\System32\drivers\etc\hosts</code> (Windows) or <code>/etc/hosts</code> (Mac OS or Linux) and add:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&lt;IP ADDRESS&gt;  dockerhost</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check if the entry is working:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ping dockerhost</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_docker_client">2.10. Docker Client</h3>
<div class="paragraph">
<p>Docker Client is used to communicate with Docker Host.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text"># Windows - From Internet
curl -L http://classroom.example.com:8082/downloads/docker/docker-1.8.2.exe -o docker.exe

# Windows - From Internet
curl -L http://test.docker.com.s3.amazonaws.com/builds/Windows/x86_64/docker-1.8.3.exe -o docker.exe

# Linux - From Internet
sudo curl -L https://get.docker.com/builds/Linux/x86_64/docker-latest -o /usr/local/bin/docker
sudo chmod +x /usr/local/bin/docker

# Linux - From Instructor
sudo curl -L http://classroom.example.com:8082/downloads/docker/docker-latest-linux -o /usr/local/bin/docker
sudo chmod +x /usr/local/bin/docker

# Mac - From Internet
sudo curl -L https://get.docker.com/builds/Darwin/x86_64/docker-latest -o /usr/local/bin/docker
sudo chmod +x /usr/local/bin/docker

# Mac - From Instructor
sudo curl -L http://classroom.example.com:8082/downloads/docker/docker-latest-mac -o /usr/local/bin/docker
sudo chmod +x /usr/local/bin/docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if the client is working by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will return an empty list of containers working. If you get an error message, make sure to have put the docker client into a folder that is contained in your path expression and that you executed the "docker-machine env lab" command according to your operatingsystem.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wildfly">2.11. WildFly</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download WildFly 9.0.1</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>from Internet: <a href="http://download.jboss.org/wildfly/9.0.1.Final/wildfly-9.0.1.Final.zip" class="bare">http://download.jboss.org/wildfly/9.0.1.Final/wildfly-9.0.1.Final.zip</a> .</p>
</li>
<li>
<p>from Instructor: <a href="http://classroom.example.com:8082/downloads/wildfly-9.0.1.Final.zip" class="bare">http://classroom.example.com:8082/downloads/wildfly-9.0.1.Final.zip</a> .</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install it by extracting the archive.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_jboss_developer_studio_9_0_0_ga">2.12. JBoss Developer Studio 9.0.0.GA</h3>
<div class="paragraph">
<p>To install JBoss Developer Studio stand-alone, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From Internet: <a href="http://www.jboss.org/download-manager/file/jboss-devstudio-9.0.0.GA-standalone_jar.jar" class="bare">http://www.jboss.org/download-manager/file/jboss-devstudio-9.0.0.GA-standalone_jar.jar</a> .</p>
</li>
<li>
<p>From Instructor: <a href="http://classroom.example.com:8082/downloads/jboss-devstudio-9.0.0.GA-installer-standalone.jar" class="bare">http://classroom.example.com:8082/downloads/jboss-devstudio-9.0.0.GA-installer-standalone.jar</a> .</p>
</li>
<li>
<p>Start the installer as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">java -jar &lt;JAR FILE NAME&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the on-screen instructions to complete the installation process.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_docker_basics">3. Docker Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>PURPOSE</strong>: This chapter introduces the basic terminology of Docker.</p>
</div>
<div class="quoteblock">
<blockquote>
Docker is a platform for developers and sysadmins to develop, ship, and run applications. Docker lets you quickly assemble applications from components and eliminates the friction that can come when shipping code. Docker lets you get your code tested and deployed into production as fast as possible.
</blockquote>
<div class="attribution">
&#8212; docs.docker.com/
</div>
</div>
<div class="paragraph">
<p>Docker simplifies software delivery by making it easy to build and share images that contain your application’s entire environment, or <em>application operating system</em>.</p>
</div>
<div class="paragraph">
<p><strong>What does it mean by an application operating system ?</strong></p>
</div>
<div class="paragraph">
<p>Your application typically require a specific version of operating system, application server, JDK, database server, may require to tune the configuration files, and similarly multiple other dependencies. The application may need binding to specific ports and certain amount of memory. The components and configuration together required to run your application is what is referred to as application operating system.</p>
</div>
<div class="paragraph">
<p>You can certainly provide an installation script that will download and install these components. Docker simplifies this process by allowing to create an image that contains your application and infrastructure together, managed as one component. These images are then used to create Docker containers which run on the container virtualization platform, provided by Docker.</p>
</div>
<div class="paragraph">
<p><strong>Main Components of Docker</strong></p>
</div>
<div class="paragraph">
<p>Docker has three main components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Images</em> are <strong>build component</strong> of Docker and a read-only template of application operating system.</p>
</li>
<li>
<p><em>Containers</em> are <strong>run component</strong> of Docker, and created from, images.Containers can be run, started, stopped, moved, and deleted.</p>
</li>
<li>
<p>Images are stored, shared, and managed in a <em>registry</em>, the <strong>distribution component</strong> of Docker. The publically available registry is known as Docker Hub (available at <a href="http://hub.docker.com" class="bare">http://hub.docker.com</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In order for these three components to work together, there is <strong>Docker Daemon</strong> that runs on a host machine and does the heavy lifting of building, running, and distributing Docker containers. In addition, there is <strong>Client</strong> that is a Docker binary which accepts commands from the user and communicates back and forth with the daemon.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/docker-architecture.png" alt="docker architecture">
</div>
<div class="title">Figure 2. Docker architecture</div>
</div>
<div class="paragraph">
<p>Client communicates with Daemon, either co-located on the same host, or on a different host. It requests the Daemon to pull an image from the repository using <code>pull</code> command. The Daemon then downloads the image from Docker Hub, or whatever registry is configured. Multiple images can be downloaded from the registry and installed on Daemon host. Images are run using <code>run</code> command to create containers on demand.</p>
</div>
<div class="paragraph">
<p><strong>How does a Docker Image work?</strong></p>
</div>
<div class="paragraph">
<p>We&#8217;ve already seen that Docker images are read-only templates from which Docker containers are launched. Each image consists of a series of layers. Docker makes use of union file systems to combine these layers into a single image. Union file systems allow files and directories of separate file systems, known as branches, to be transparently overlaid, forming a single coherent file system.</p>
</div>
<div class="paragraph">
<p>One of the reasons Docker is so lightweight is because of these layers. When you change a Docker image—for example, update an application to a new version— a new layer gets built. Thus, rather than replacing the whole image or entirely rebuilding, as you may do with a virtual machine, only that layer is added or updated. Now you don&#8217;t need to distribute a whole new image, just the update, making distributing Docker images faster and simpler.</p>
</div>
<div class="paragraph">
<p>Every image starts from a base image, for example <code>ubuntu</code>, a base Ubuntu image, or <code>fedora</code>, a base Fedora image. You can also use images of your own as the basis for a new image, for example if you have a base Apache image you could use this as the base of all your web application images.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, Docker obtains these base images from Docker Hub.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Docker images are then built from these base images using a simple, descriptive set of steps we call instructions. Each instruction creates a new layer in our image. Instructions include actions like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run a command</p>
</li>
<li>
<p>Add a file or directory</p>
</li>
<li>
<p>Create an environment variable</p>
</li>
<li>
<p>Run a process when launching a container</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These instructions are stored in a file called a Dockerfile. Docker reads this Dockerfile when you request a build of an image, executes the instructions, and returns a final image.</p>
</div>
<div class="paragraph">
<p><strong>How does a Container work?</strong></p>
</div>
<div class="paragraph">
<p>A container consists of an operating system, user-added files, and meta-data. As we&#8217;ve seen, each container is built from an image. That image tells Docker what the container holds, what process to run when the container is launched, and a variety of other configuration data. The Docker image is read-only. When Docker runs a container from an image, it adds a read-write layer on top of the image (using a union file system as we saw earlier) in which your application can then run.</p>
</div>
<div class="sect2">
<h3 id="_docker_machine_2">3.1. Docker Machine</h3>
<div class="paragraph">
<p>Machine makes it really easy to create Docker hosts on your computer, on cloud providers and inside your own data center. It creates servers, installs Docker on them, then configures the Docker client to talk to them.</p>
</div>
<div class="paragraph">
<p>Once your Docker host has been created, it then has a number of commands for managing containers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start, stop, restart container</p>
</li>
<li>
<p>Upgrade Docker</p>
</li>
<li>
<p>Configure the Docker client to talk to a host</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You used Docker Machine already during the attendee setup. We won&#8217;t need it too much further on. But if you need to create hosts, it&#8217;s a very handy tool to know about. From now on we&#8217;re mostly going to use the docker client.</p>
</div>
<div class="paragraph">
<p>Find out more about the details at the <a href="https://docs.docker.com/machine/">Docker Machine Website</a>.</p>
</div>
<div class="paragraph">
<p>Check if docker machine is working:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-machine -v</pre>
</div>
</div>
<div class="paragraph">
<p>It shows the output similar to the one shown below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-machine version 0.4.1 (e2c88d6)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The exact version may differ based upon how recently the installation was performed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_docker_client_2">3.2. Docker Client</h3>
<div class="paragraph">
<p>The client communicates with the demon process on your host and let&#8217;s you work with images and containers.</p>
</div>
<div class="paragraph">
<p>Check if your client is working using the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker -v</pre>
</div>
</div>
<div class="paragraph">
<p>It shows the output similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Docker version 1.8.2, build 0a8c2e3</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The exact version may differ based upon how recently the installation was performed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The most important options you&#8217;ll be using frequently are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>run</code> - runs a container</p>
</li>
<li>
<p><code>ps</code>- lists containers</p>
</li>
<li>
<p><code>stop</code> - stops a container</p>
</li>
<li>
<p><code>rm</code> - Removes a container</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Get a full list of available commands with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker</pre>
</div>
</div>
<div class="paragraph">
<p>A more comprehensive list of commands is also available in <a href="#Common_Docker_Commands">Common Docker Commands</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_verify_docker_configuration">3.3. Verify Docker Configuration</h3>
<div class="paragraph">
<p>Check if your Docker Host is running:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-machine ls</pre>
</div>
</div>
<div class="paragraph">
<p>You should see the output similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">NAME        ACTIVE   DRIVER       STATE     URL                         SWARM
lab                  virtualbox   Running   tcp://192.168.99.101:2376</code></pre>
</div>
</div>
<div class="paragraph">
<p>This machine is shown in &#8220;Running&#8221; state. If the machine state is stopped, start it with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-machine start lab</pre>
</div>
</div>
<div class="paragraph">
<p>After it is started you can find out IP address of your Docker Host with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-machine ip lab</pre>
</div>
</div>
<div class="paragraph">
<p>We already did this during the setup document, remember? So, this is a good chance to check, if you already added this IP to your hosts file.</p>
</div>
<div class="paragraph">
<p>Type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ping dockerhost</pre>
</div>
</div>
<div class="paragraph">
<p>and see if this resolves to the IP address that the docker-machine command printed out. You should see an output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; ping dockerhost
PING dockerhost (192.168.99.101): 56 data bytes
64 bytes from 192.168.99.101: icmp_seq=0 ttl=64 time=0.394 ms
64 bytes from 192.168.99.101: icmp_seq=1 ttl=64 time=0.387 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it does, you&#8217;re ready to start with the lab.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_container">4. Run Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step in running any application on Docker is to run a container from an image. There are plenty of images available from the official Docker registry (aka <a href="https://hub.docker.com">Docker Hub</a>). To run any of them, you just have to ask the Docker Client to run it. The client will check if the image already exists on Docker Host. If it exists then it&#8217;ll run it, otherwise the host will download the image and then run it.</p>
</div>
<div class="sect2">
<h3 id="_pull_image">4.1. Pull Image</h3>
<div class="paragraph">
<p>Let&#8217;s first check, if any images are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first, this list only contains the Docker swarm image, we used earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">REPOSITORY                           TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
swarm     latest              556c60f87888        33 hours ago        10.2 MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get a vanilla <code>jboss/wildfly</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker pull jboss/wildfly:latest

#From Instructor
docker pull classroom.example.com:5000/wildfly:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, docker images are retrieved from <a href="https://hub.docker.com/">Docker Hub</a>. In our case, we&#8217;re providing a so called private registry via the instructor laptop.</p>
</div>
<div class="paragraph">
<p>You can see, that Docker is downloading the image with it&#8217;s different layers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In a traditional Linux boot, the Kernel first mounts the root File System as read-only, checks its integrity, and then switches the whole rootfs volume to read-write mode.
When Docker mounts the rootfs, it starts read-only, as in a traditional Linux boot, but then, instead of changing the file system to read-write mode, it takes advantage of a union mount to add a read-write file system over the read-only file system. In fact there may be multiple read-only file systems stacked on top of each other. Consider each one of these file systems as a layer.</p>
</div>
<div class="paragraph">
<p>At first, the top read-write layer has nothing in it, but any time a process creates a file, this happens in the top layer. And if something needs to update an existing file in a lower layer, then the file gets copied to the upper layer and changes go into the copy. The version of the file on the lower layer cannot be seen by the applications anymore, but it is there, unchanged.</p>
</div>
<div class="paragraph">
<p>We call the union of the read-write layer and all the read-only layers a <em>union file system</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/plain-wildfly0.png" alt="plain wildfly0">
</div>
<div class="title">Figure 3. Docker Layers</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our particular case, the <a href="https://github.com/jboss-dockerfiles/wildfly/blob/9.0.1.Final/Dockerfile">jboss/wildfly</a> image extends the <a href="https://github.com/jboss-dockerfiles/base-jdk/blob/jdk8/Dockerfile">jboss/base-jdk:8</a> image which adds the OpenJDK distribution on top of the <a href="https://github.com/jboss-dockerfiles/base/blob/master/Dockerfile">jboss/base</a> image.
The base image is used for all JBoss community images. It provides a base layer that includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A jboss user (uid/gid 1000) with home directory set to <code>/opt/jboss</code></p>
</li>
<li>
<p>A few tools that may be useful when extending the image or installing software, like unzip.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The &#8220;jboss/base-jdk:8&#8221; image adds:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>OpenJDK 8 distribution</p>
</li>
<li>
<p>Adds a <code>JAVA_HOME</code> environment variable</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the download is done, you can list the images again and will see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
jboss/wildfly       latest              7688aaf382ab        6 weeks ago         581.4 MB
swarm               latest              207e8b983242        9 weeks ago         10.2 MB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_2">4.2. Run Container</h3>
<div class="paragraph">
<p>For now, all we did is pull the container description (aka image) down to our local laptops. Now we want to actually run an instance of the image as a so called "container".</p>
</div>
<div class="sect3">
<h4 id="_interactive_container">4.2.1. Interactive Container</h4>
<div class="paragraph">
<p>Typically container run in the background. They are launched and forgotten. And this is the default behaviour for Docker.
But there is a way we can make them behave like an instance with an interactive console.
To run the WildFly container in an interactive mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -it jboss/wildfly

#From Instructor
docker run -it classroom.example.com:5000/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will show the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /opt/jboss/wildfly

  JAVA: /usr/lib/jvm/java/bin/java

  JAVA_OPTS:  -server -XX:+UseCompressedOops  -server -XX:+UseCompressedOops -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true

=========================================================================

OpenJDK 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0
17:02:58,000 INFO  [org.jboss.modules] (main) JBoss Modules version 1.4.3.Final
17:02:58,251 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.6.Final
17:02:58,311 INFO  [org.jboss.as] (MSC service thread 1-2) WFLYSRV0049: WildFly Full 9.0.1.Final (WildFly Core 1.0.1.Final) starting
17:02:59,558 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 11) WFLYCTL0028: Attribute 'job-repository-type' in the resource at address '/subsystem=batch' is deprecated, and may be removed in future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
17:02:59,560 INFO  [org.jboss.as.controller.management-deprecated] (ServerService Thread Pool -- 3) WFLYCTL0028: Attribute 'enabled' in the resource at address '/subsystem=datasources/data-source=ExampleDS' is deprecated, and may be removed in future version. See the attribute description in the output of the read-resource-description operation to learn more about the deprecation.
...
17:03:00,610 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0006: Undertow HTTP listener default listening on /0.0.0.0:8080
17:03:00,715 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-2) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
17:03:00,881 INFO  [org.jboss.ws.common.management] (MSC service thread 1-1) JBWS022052: Starting JBoss Web Services - Stack CXF Server 5.0.0.Final
17:03:00,891 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-2) WFLYDS0013: Started FileSystemDeploymentService for directory /opt/jboss/wildfly/standalone/deployments
17:03:01,131 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
17:03:01,133 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
17:03:01,138 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 9.0.1.Final (WildFly Core 1.0.1.Final) started in 3431ms - Started 203 of 379 services (210 services are lazy, passive or on-demand)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that the server started correctly, congratulations!</p>
</div>
<div class="paragraph">
<p>The switches do the following: <code>-i</code> allows to interact with the STDIN and <code>-t</code> attach a TTY to the process. Switches can be combined together and used as <code>-it</code>.</p>
</div>
<div class="paragraph">
<p>Hit Ctrl+C to stop the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="_detached_container">4.2.2. Detached Container</h4>
<div class="paragraph">
<p>Restart the container in detached mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name mywildfly -d jboss/wildfly

#From Instructor
docker run --name mywildfly -d classroom.example.com:5000/wildfly

972f51cc8422eec0a7ea9a804a55a2827b5537c00a6bfd45f8646cb764bc002a</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-d</code>, instead of <code>-it</code>, runs the container in detached mode.</p>
</div>
<div class="paragraph">
<p>The output is the unique id assigned to the container. You can use it to refer to the container in various contexts. Check the logs as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker logs 972f51cc8422eec0a7ea9a804a55a2827b5537c00a6bfd45f8646cb764bc002a
=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /opt/jboss/wildfly

. . .</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can check it by issuing the <code>docker ps</code> command which retrieves the images process which are running and the ports engaged by the process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
7da1c7614edf        jboss/wildfly       &quot;/opt/jboss/wildfly/   About a minute ago   Up About a minute   8080/tcp            mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Noticed the "NAMES" column? This is a quick way of refering to your container. Let&#8217;s try to look at the logs again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker logs mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>That looks easier.</p>
</div>
<div class="paragraph">
<p>Also try <code>docker ps -a</code> to see all the containers on this machine.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_with_default_port">4.3. Run Container with Default Port</h3>
<div class="paragraph">
<p>Startup log of the server shows that the server is located in the <code>/opt/jboss/wildfly</code>. It also shows that the public interfaces are bound to the <code>0.0.0.0</code> address while the admin interfaces are bound just to <code>localhost</code>. This information will be useful to learn how to customize the server.</p>
</div>
<div class="paragraph">
<p><code>docker-machine ip &lt;machine-name&gt;</code> gives us the Docker Host IP address and this was already added to the hosts file. So, we can give it another try by accessing: <a href="http://dockerhost:8080" class="bare">http://dockerhost:8080</a>. However, this will not work either.</p>
</div>
<div class="paragraph">
<p>If you want containers to accept incoming connections, you will need to provide special options when invoking <code>docker run</code>. The container, we just started, can&#8217;t be accessed by our browser. We need to stop it again and restart with different options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name mywildfly-exposed-ports -d -P jboss/wildfly

#From Instructor
docker run --name mywildfly-exposed-ports -d -P classroom.example.com:5000/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-P</code> map any exposed ports inside the image to a random port on the Docker host. This can be verified as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                     NAMES
7f41a5a0cfd6        jboss/wildfly      &quot;/opt/jboss/wildfly/   52 seconds ago      Up 52 seconds       0.0.0.0:32768-&gt;8080/tcp   mywildfly-exposed-ports</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port mapping is shown in the <code>PORTS</code> column. Access the WildFly server at <a href="http://dockerhost:32768" class="bare">http://dockerhost:32768</a>. Make sure to use the correct port number as shown in your case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Exact port number may be different in your case.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_with_specified_port">4.4. Run Container with Specified Port</h3>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop mywildfly-exposed-ports</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name mywildfly-mapped-ports -d -p 8080:8080 jboss/wildfly

#From Instructor
docker run --name mywildfly-mapped-ports -d -p 8080:8080 classroom.example.com:5000/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>The format is <code>-p hostPort:containerPort</code>. This option maps container ports to host ports and allows other containers on our host to access them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Docker Port Mapping</div>
<div class="paragraph">
<p>Port exposure and mapping are the keys to successful work with Docker.
See more about networking on the Docker website <a href="https://docs.docker.com/articles/networking/">Advanced Networking</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to test <a href="http://dockerhost:8080" class="bare">http://dockerhost:8080</a> again. This works with the exposed port, as expected.</p>
</div>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop mywildfly-mapped-ports</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/plain-wildfly1.png" alt="plain wildfly1">
</div>
<div class="title">Figure 4. Welcome WildFly</div>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_WildFly_Administration">4.5. Enabling WildFly Administration</h3>
<div class="paragraph">
<p>Default WildFly image exposes only port 8080 and thus is not available for administration using either the CLI or Admin Console. Lets expose the ports in different ways.</p>
</div>
<div class="sect3">
<h4 id="_default_port_mapping">4.5.1. Default Port Mapping</h4>
<div class="paragraph">
<p>The following command will override the default command in Docker file, start WildFly, and bind application and management port to all network interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name managed-wildfly -P -d jboss/wildfly /opt/jboss/wildfly/bin/standalone.sh -b 0.0.0.0 -bmanagement 0.0.0.0

#From Instructor
docker run --name managed-wildfly -P -d classroom.example.com:5000/wildfly /opt/jboss/wildfly/bin/standalone.sh -b 0.0.0.0 -bmanagement 0.0.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessing WildFly Administration Console require a user in administration realm. A pre-created image, with appropriate username/password credentials, is used to start WildFly as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name managed-wildfly-from-image -P -d rafabene/wildfly-admin

#From Instructor
docker run --name managed-wildfly-from-image -P -d classroom.example.com:5000/wildfly-management</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-P</code> map any exposed ports inside the image to a random port on Docker host.</p>
</div>
<div class="paragraph">
<p>Look at the exposed ports as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker ps
CONTAINER ID        IMAGE                       COMMAND                CREATED             STATUS              PORTS                                                       NAMES
5fdedef5573b        rafabene/wildfly-admin      &quot;/bin/sh -c '/opt/jb   15 seconds ago      Up 15 seconds       0.0.0.0:32772-&gt;8080/tcp, 0.0.0.0:32771-&gt;9990/tcp   managed-wildfly-from-image
ee30433b5414        jboss/wildfly               &quot;/opt/jboss/wildfly/   59 seconds ago      Up 59 seconds       0.0.0.0:32769-&gt;8080/tcp                            managed-wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look for the host port that is mapped in the container, <code>32769</code> in this case. Access the admin console at <a href="http://dockerhost:32769" class="bare">http://dockerhost:32769</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Exact port number may be different in your case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The username/password credentials are:</p>
</div>
<table id="WildFly_Administration_Credentials" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker#admin</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This shows the admin console as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly-admin-console.png" alt="wildfly admin console">
</div>
<div class="title">Figure 5. Welcome WildFly</div>
</div>
<div class="sect4">
<h5 id="_additional_ways_to_find_port_mapping">Additional Ways To Find Port Mapping</h5>
<div class="paragraph">
<p>The exact mapped port can also be found as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>docker port</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker port managed-wildfly-from-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>to see the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">0.0.0.0:32769-&gt;8080/tcp
0.0.0.0:32770-&gt;9990/tcp</code></pre>
</div>
</div>
</li>
<li>
<p>Using <code>docker inspect</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker inspect --format='{{(index (index .NetworkSettings.Ports &quot;9990/tcp&quot;) 0).HostPort}}' managed-wildfly-from-image</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Management_Fixed_Port_Mapping">4.5.2. Fixed Port Mapping</h4>
<div class="paragraph">
<p>This management image can also be started with a pre-defined port mapping as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -p 8080:8080 -p 9990:9990 -d rafabene/wildfly-admin

#From Instructor
docker run -p 8080:8080 -p 9990:9990 -d classroom.example.com:5000/wildfly-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, Docker port mapping will be shown as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">8080/tcp -&gt; 0.0.0.0:8080
9990/tcp -&gt; 0.0.0.0:9990</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stop_and_remove_container">4.6. Stop and Remove Container</h3>
<div class="sect3">
<h4 id="_stop_container">4.6.1. Stop Container</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop a specific container:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop &lt;CONTAINER ID&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Stop all the running containers</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop `docker ps -aq`</code></pre>
</div>
</div>
</li>
<li>
<p>Stop only the exited containers</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker ps -a -f &quot;exited=-1&quot;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_remove_container">4.6.2. Remove Container</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove a specific container:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker rm 0bc123a8ece0</code></pre>
</div>
</div>
</li>
<li>
<p>Remove containers meeting a regular expression</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm</code></pre>
</div>
</div>
</li>
<li>
<p>Remove all containers, without any criteria</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker rm `docker ps -aq`</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JavaEE7_PreBuilt_WAR">5. Deploy Java EE 7 Application (Pre-Built WAR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/javaee-samples/javaee7-hol">Java EE 7 Movieplex</a> is a standard multi-tier enterprise application that shows design patterns and anti-patterns for a typical Java EE 7 application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-hol.png" alt="javaee7 hol">
</div>
<div class="title">Figure 6. Java EE 7 Application Architecture</div>
</div>
<div class="paragraph">
<p>Pull the Docker image that contains WildFly and pre-built Java EE 7 application WAR file as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker pull arungupta/javaee7-hol

#From Instructor
docker pull classroom.example.com:5000/javaee7-hol</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/arun-gupta/docker-images/blob/master/javaee7-hol/Dockerfile">javaee7-hol Dockerfile</a> is based on <code>jboss/wildfly</code> and adds the movieplex7 application as war file.</p>
</div>
<div class="paragraph">
<p>Run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -it -p 8080:8080 arungupta/javaee7-hol

#From Instructor
docker run -it -p 8080:8080 classroom.example.com:5000/javaee7-hol</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the application in action at <a href="http://dockerhost:8080/movieplex7/" class="bare">http://dockerhost:8080/movieplex7/</a>. The output is shown:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It might take a while for the container to come up. Wait for the server to complete the startup.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-movieplex7.png" alt="javaee7 movieplex7">
</div>
<div class="title">Figure 7. Java EE 7 Application Output</div>
</div>
<div class="paragraph">
<p>This uses an in-memory database with WildFly application server as shown in the image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-hol-in-memory-database.png" alt="javaee7 hol in memory database">
</div>
<div class="title">Figure 8. In-memory Database</div>
</div>
<div class="paragraph">
<p>Only two changes are required to the standard <code>jboss/wildfly</code> image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>By default, WildFly starts in Web platform. This Java EE 7 application uses some capabilities from the Full Platform and so WildFly is started in that mode instead as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">CMD [&quot;/opt/jboss/wildfly/bin/standalone.sh&quot;, &quot;-c&quot;, &quot;standalone-full.xml&quot;, &quot;-b&quot;, &quot;0.0.0.0&quot;]</code></pre>
</div>
</div>
</li>
<li>
<p>WAR file is copied to the <code>standalone/deployments</code> directory as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">RUN curl -L https://github.com/javaee-samples/javaee7-hol/raw/master/solution/movieplex7-1.0-SNAPSHOT.war -o /opt/jboss/wildfly/standalone/deployments/movieplex7-1.0-SNAPSHOT.war</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JavaEE7_Container_Linking">6. Deploy Java EE 7 Application (Container Linking)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#JavaEE7_PreBuilt_WAR">Deploy Java EE 7 Application (Pre-Built WAR)</a> explained how to use an in-memory database with the application server. This gets you started rather quickly but becomes a bottleneck soon as the database is only in-memory. This means that any changes made to your schema and data are lost when the application server shuts down. In this case, you need to use a database server that resides outside the application server. For example, MySQL as the database server and WildFly as the application server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-hol-container-linking.png" alt="javaee7 hol container linking">
</div>
<div class="title">Figure 9. Two Containers On Same Docker Host</div>
</div>
<div class="paragraph">
<p>This section will show how <a href="https://docs.docker.com/userguide/dockerlinks/">Docker Container Linking</a> can be used to connect to a service running inside a Docker container via a network port.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start MySQL server as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name mysqldb -e MYSQL_USER=mysql -e MYSQL_PASSWORD=mysql -e MYSQL_DATABASE=sample -e MYSQL_ROOT_PASSWORD=supersecret -p 3306:3306 -d mysql

#From Instructor
docker run --name mysqldb -e MYSQL_USER=mysql -e MYSQL_PASSWORD=mysql -e MYSQL_DATABASE=sample -e MYSQL_ROOT_PASSWORD=supersecret -p 3306:3306 -d classroom.example.com:5000/mysql</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-e</code> define environment variables that are read by the database at startup and allow us to access the database with this user and password.</p>
</div>
</li>
<li>
<p>Start WildFly with the deployed Java EE 7 application as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -d --name mywildfly-mysql --link mysqldb:db -p 8080:8080 arungupta/wildfly-mysql-javaee7

#From Instructor
docker run -d --name mywildfly-mysql --link mysqldb:db -p 8080:8080 classroom.example.com:5000/wildfly-mysql-javaee7</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>--link</code> takes two parameters - first is name of the container we&#8217;re linking to and second is the alias for the link name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Container Linking</div>
<div class="paragraph">
<p>Creating a link between two containers creates a conduit between a source container and a target container and securely transfer information about source container to target container.</p>
</div>
<div class="paragraph">
<p>In our case, target container (WildFly) can see information about source container (MySQL). When containers are linked, information about a source container can be sent to a recipient container. This allows the recipient to see selected data describing aspects of the source container. For example, IP address of MySQL server is expoed at $DB_PORT_3306_TCP_ADDR and port of MySQL server is exposed at $DB_PORT_3306_TCP_PORT. These are then used to create the JDBC resource.</p>
</div>
<div class="paragraph">
<p>See more about container communication on the Docker website <a href="https://docs.docker.com/userguide/dockerlinks/">Linking Containers Together</a></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>See the output as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; curl http://dockerhost:8080/employees/resources/employees
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;&lt;collection&gt;&lt;employee&gt;&lt;id&gt;1&lt;/id&gt;&lt;name&gt;Penny&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;2&lt;/id&gt;&lt;name&gt;Sheldon&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;3&lt;/id&gt;&lt;name&gt;Amy&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;4&lt;/id&gt;&lt;name&gt;Leonard&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;5&lt;/id&gt;&lt;name&gt;Bernadette&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;6&lt;/id&gt;&lt;name&gt;Raj&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;7&lt;/id&gt;&lt;name&gt;Howard&lt;/name&gt;&lt;/employee&gt;&lt;employee&gt;&lt;id&gt;8&lt;/id&gt;&lt;name&gt;Priya&lt;/name&gt;&lt;/employee&gt;&lt;/collection&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you get a 404 or any other error, wait for a little longer until the containers are started up.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop mywildfly-mysql</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_and_deploy_java_ee_7_application">7. Build and Deploy Java EE 7 Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you learned a lot about images, containers and how to link them together, it is about time to learn about the different deployment options. Let&#8217;s start over with the Java EE 7 sample applications again.
<a href="https://github.com/javaee-samples/javaee7-simple-sample">Java EE 7 Simple Sample</a> is a trivial Java EE 7 sample application and a perfect way to start.</p>
</div>
<div class="sect2">
<h3 id="Build_Application">7.1. Build Application</h3>
<div class="paragraph">
<p>We&#8217;re going to build the application first.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the repo:</p>
<div class="literalblock">
<div class="content">
<pre>#From Internet
git clone https://github.com/javaee-samples/javaee7-simple-sample.git</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>#From Instructor
git clone http://root:dockeradmin@classroom.example.com:10080/root/javaee7-simple-sample.git</pre>
</div>
</div>
</li>
<li>
<p>Build the application:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">  cd javaee7-simple-sample/

  #From Internet
  mvn clean package

  #From Instructor
  curl http://classroom.example.com:8082/downloads/lab-settings.xml -o settings.xml
  mvn -s settings.xml clean package</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_application_server">7.2. Start Application Server</h3>
<div class="paragraph">
<p>Create a folder to place the deployments and give it write access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">mkdir deployments
chmod a+w deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start WildFly server as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name wildfly -d -p 8080:8080 -v `pwd`/deployments:/opt/jboss/wildfly/standalone/deployments/:rw jboss/wildfly

#From Instructor
docker run --name wildfly -d -p 8080:8080 -v `pwd`/deployments:/opt/jboss/wildfly/standalone/deployments/:rw classroom.example.com:5000/wildfly</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Windows users need to tweak this a bit and copy the deployments to c:/Users/&lt;USER&gt;/deployments because the directory mappings for boot2docker work differently on those systems. Please update the docker -v argument accordingly.</p>
</div>
<div class="paragraph">
<p>'docker run --name wildfly -d -p 8080:8080 -v /c/Users/meisele/deployments:/opt/jboss/wildfly/standalone/deployments/:rw [classroom.example.com:5000|jboss]/wildfly'</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This command starts a container named &#8220;wildfly&#8221;.</p>
</div>
<div class="paragraph">
<p>The <code>-v</code> flag maps a directory from the host into the container. This will be the directory to put the deployments. <code>rw</code> ensures that the Docker container can write to it.</p>
</div>
<div class="paragraph">
<p>Check logs to verify if the server has started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker logs -f wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access <a href="http://dockerhost:8080" class="bare">http://dockerhost:8080</a> in your browser to make sure the instance is up and running.</p>
</div>
<div class="paragraph">
<p>Now you&#8217;re ready to deploy the application for the first time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_jboss_developer_studio">7.3. Configure JBoss Developer Studio</h3>
<div class="paragraph">
<p>Start JBoss Developer Studio, if not already started.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select &#8216;Servers&#8217; tab, create a new server adapter</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds1.png" alt="jbds1">
</div>
<div class="title">Figure 10. Server adapter</div>
</div>
</li>
<li>
<p>Assign an existing or create a new WildFly 9.0.0 runtime (changed properties are highlighted.)</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds2.png" alt="jbds2">
</div>
<div class="title">Figure 11. WildFly Runtime Properties</div>
</div>
</li>
<li>
<p>If a new runtime needs to be created, pick the directory for WildFly 9.0.1:</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds3.png" alt="jbds3">
</div>
<div class="title">Figure 12. WildFly 9.0.1.Final Runtime</div>
</div>
<div class="paragraph">
<p>Click on &#8216;Finish&#8217;.</p>
</div>
</li>
<li>
<p>Double-click on the newly selected server to configure server properties:</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds4.png" alt="jbds4">
</div>
<div class="title">Figure 13. Server properties</div>
</div>
<div class="paragraph">
<p>The host name is specified to &#8216;dockerhost&#8217;. Two properties on the left are automatically propagated from the previous dialog. Additional two properties on the right side are required to disable to keep deployment scanners in sync with the server.</p>
</div>
</li>
<li>
<p>Specify a custom deployment folder on Deployment tab of Server Editor</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds5.png" alt="jbds5">
</div>
<div class="title">Figure 14. Custom deployment folder</div>
</div>
</li>
<li>
<p>Right-click on the newly created server adapter and click &#8216;Start&#8217;.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds6.png" alt="jbds6">
</div>
<div class="title">Figure 15. Started server</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_using_shared_volumes">7.4. Deploy Application Using Shared Volumes</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import javaee7-simple-sample application source code using Import &#8594; Existing Maven Projects.</p>
</li>
<li>
<p>Right-click on the project, select &#8216;Run on Server&#8217; and chose the previously created server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The project runs and displays the start page of the application.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds7.png" alt="jbds7">
</div>
<div class="title">Figure 16. Start Server</div>
</div>
<div class="paragraph">
<p>Congratulations!</p>
</div>
<div class="paragraph">
<p>You&#8217;ve deployed your first application to WildFly running in a Docker container from JBoss Developer Studio.</p>
</div>
<div class="paragraph">
<p>Stop WildFly container when you&#8217;re done.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker stop wildfly</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_using_cli">7.5. Deploy Application Using CLI</h3>
<div class="paragraph">
<p>TThe Command Line Interface (CLI) is a tool for connecting to WildFly instances to manage all tasks from command line environment. Some of the tasks that you can do using the CLI are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy/Undeploy web application in standalone/Domain Mode.</p>
</li>
<li>
<p>View all information about the deployed application on runtime.</p>
</li>
<li>
<p>Start/Stop/Restart Nodes in respective mode i.e. Standalone/Domain.</p>
</li>
<li>
<p>Adding/Deleting resource or subsystems to servers.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Lets use the CLI to deploy javaee7-simple-sample to WildFly running in the container.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CLI needs to be locally installed and comes as part of WildFly. This should be available in the previously downloaded WildFly. Unzip into a folder of your choice (e.g. <code>/Users/&lt;USER&gt;/tools/</code>). This will create <code>wildfly-9.0.0.Final</code> directory here. This folder is referred to $WIDLFY_HOME from here on. Make sure to add the <code>/Users/&lt;USER&gt;/tools/wildfly-9.0.0.Final/bin</code> to your $PATH.</p>
</li>
<li>
<p>Run the &#8220;wildfly-management&#8221; image with fixed port mapping as explained in <a href="#Management_Fixed_Port_Mapping">Fixed Port Mapping</a>.</p>
</li>
<li>
<p>Run the <code>jboss-cli</code> command and connect to the WildFly instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Start WildFly server as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name wildfly-managed -d -p 8080:8080 -p 9990:9990 rafabene/wildfly-admin

#From Instructor
docker run --name wildfly-managed -d -p 8080:8080 -p 9990:9990 classroom.example.com:5000/wildfly-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command starts a container named &#8220;wildfly-managed&#8221;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">jboss-cli.sh --controller=dockerhost:9990  -u=admin -p=docker#admin -c</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will show the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">[standalone@dockerhost:9990 /]</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the application as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">deploy &lt;javaee7-simple-sample PATH&gt;target/javaee7-simple-sample-1.10.war --force</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you&#8217;ve sucessfully used the CLI to remote deploy the Java EE 7 sample application to WildFly running as docker container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_using_web_console">7.6. Deploy Application Using Web Console</h3>
<div class="paragraph">
<p>WildFly comes with a web-based administration console. It also relies on the same management APIs that are used by JBoss Developer Tools and the CLI. It provides a simple and easy to use web-based console to manage WildFly instance. For a Docker image, it needs to be explicitly enabled as explained in <a href="#Enabling_WildFly_Administration">Enabling WildFly Administration</a>. Once enabled, it can be accessed at <a href="http://dockerhost:9990" class="bare">http://dockerhost:9990</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/console1.png" alt="console1">
</div>
<div class="title">Figure 17. WildFly Web Console</div>
</div>
<div class="paragraph">
<p>Username and password credentials are shown in <a href="#WildFly_Administration_Credentials">[WildFly_Administration_Credentials]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You may like to stop and remove the Docker container running WildFly. This can be done as <code>docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f</code>.</p>
</div>
<div class="paragraph">
<p>Start a new container as <code>docker run -d --name wildfly -p 8080:8080 -p 9990:9990 classroom.example.com:5000/wildfly-management</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Deploy the application using the console with the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to &#8216;Deployments&#8217; tab.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly9-deployments-tab.png" alt="wildfly9 deployments tab">
</div>
<div class="title">Figure 18. Deployments tab in WildFly Web Console</div>
</div>
</li>
<li>
<p>Click on &#8216;Add&#8217; button.</p>
</li>
<li>
<p>On &#8216;Add Deployment&#8217; screen, take the default of &#8216;Upload a new deployment&#8217; and click &#8216;Next&gt;&gt;&#8217;.</p>
</li>
<li>
<p>Click on &#8216;Choose File&#8217;, select <code>&lt;javaee7-simple-sample PATH&gt;/javaee7-simple-sample.war</code> file on your computer. This would be <code>javaee7-simple-sample/target/javaee7-simple-sample.war</code> from <a href="#Build_Application">Build Application</a>.</p>
</li>
<li>
<p>Click on &#8216;Next&gt;&gt;&#8217;.</p>
</li>
<li>
<p>Select &#8216;Enable&#8217; checkbox.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly9-add-deployments.png" alt="wildfly9 add deployments">
</div>
<div class="title">Figure 19. Enable a deployment</div>
</div>
</li>
<li>
<p>Click &#8216;Finish&#8217;.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly9-javaee7-simple-sample-deployed.png" alt="wildfly9 javaee7 simple sample deployed">
</div>
<div class="title">Figure 20. Java EE 7 Simple Sample Deployed</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This will complete the deployment of the Java EE 7 application using Web Console. The output can be seen out <a href="http://dockerhost:8080/javaee7-simple-sample" class="bare">http://dockerhost:8080/javaee7-simple-sample</a> and looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly9-javaee7-simple-sample-output.png" alt="wildfly9 javaee7 simple sample output">
</div>
<div class="title">Figure 21. Java EE 7 Simple Sample Output</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_using_management_api">7.7. Deploy Application Using Management API</h3>
<div class="paragraph">
<p>A standalone WildFly process, process can be configured to listen for remote management requests using its &#8220;native management interface&#8221;. The CLI tool that comes with the application server uses this interface, and user can develop custom clients that use it as well. By default, WildFly management interface listens on 127.0.0.1. When running inside a Docker container, the network interface should be bound to all publicly assigned addresses. This can be easily changed by biding to 0.0.0.0 instead of 127.0.0.1.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start another WildFly instance again:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -d --name wildfly -p 8080:8080 -p 9990:9990 rafabene/wildfly-admin

#From Instructor
docker run -d --name wildfly -p 8080:8080 -p 9990:9990 classroom.example.com:5000/wildfly-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to application port 8080, the administration port 9990 is exposed as well. The WildFly image that is used has tweaked the start script such that the management interface is bound to 0.0.0.0.</p>
</div>
</li>
<li>
<p>Create a new server adapter in JBoss Developer Studio and name it &#8220;WildFly 9.0.0-Management&#8221;. Specify the host name as &#8216;dockerhost&#8217;.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds8.png" alt="jbds8">
</div>
</div>
</li>
<li>
<p>Click on &#8216;Next&gt;&#8217; and change the values as shown.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds9.png" alt="jbds9">
</div>
<div class="title">Figure 22. Create New Server Adapter</div>
</div>
</li>
<li>
<p>Take the default values in &#8216;Remote System Integration&#8217; and click on &#8216;Finish&#8217;.</p>
</li>
<li>
<p>Change server properties by double clicking on the newly created server adapter. Specify admin credentials (username: docker, password: docker#admin). Note, you need to delete the existing password and use this instead:</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds10.png" alt="jbds10">
</div>
<div class="title">Figure 23. Management Login Credentials</div>
</div>
</li>
<li>
<p>Right-click on the newly created server adapter and click &#8216;Start&#8217;. Status quickly changes to &#8216;Started&#8217; as shown.</p>
<div class="imageblock">
<div class="content">
<img src="chapters/images/jbds11.png" alt="jbds11">
</div>
<div class="title">Figure 24. Synchronized WildFly Server</div>
</div>
</li>
<li>
<p>Right-click on the javaee7-simple-sample project, select &#8216;Run on Server&#8217; and choose this server. The project runs and displays the start page of the application.</p>
</li>
<li>
<p>Stop WildFly when you&#8217;re done.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop wildfly</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Docker_Compose">8. Multiple Containers Using Docker Compose</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Docker Compose is a tool for defining and running complex applications with Docker. With Compose, you define a multi-container application in a single file, then spin your application up in a single command which does everything that needs to be done to get it running.
</blockquote>
<div class="attribution">
&#8212; github.com/docker/compose
</div>
</div>
<div class="paragraph">
<p>An application using Docker containers will typically consist of multiple containers. With Docker Compose, there is no need to write shell scripts to start your containers. All the containers are defined in a configuration file using <em>services</em>, and then <code>docker-compose</code> script is used to start, stop, and restart the application and all the services in that application, and all the containers within that service. The complete list of commands is:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>build</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build or rebuild services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get help on a command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kill</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kill containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View output from containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print the public port for a port binding</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pull</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulls service images</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>restart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restart services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove stopped containers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>run</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a one-off command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set number of containers for a service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>up</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and start containers</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
According to <a href="https://docs.docker.com/compose/install/" class="bare">https://docs.docker.com/compose/install/</a> "You can run Compose on OS X and 64-bit Linux. It is currently not supported on the Windows operating system."
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_install_docker_compose">8.1. Install docker compose</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="txt">curl -L https://github.com/docker/compose/releases/download/1.4.2/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_file">8.2. Configuration File</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Entry point to Compose is <code>docker-compose.yml</code>. Lets use the following file:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">mysqldb</span>:
  <span class="key">image</span>: <span class="string"><span class="content">[classroom.example.com:5000/]mysql</span></span>
  <span class="key">environment</span>:
    <span class="key">MYSQL_DATABASE</span>: <span class="string"><span class="content">sample</span></span>
    <span class="key">MYSQL_USER</span>: <span class="string"><span class="content">mysql</span></span>
    <span class="key">MYSQL_PASSWORD</span>: <span class="string"><span class="content">mysql</span></span>
    <span class="key">MYSQL_ROOT_PASSWORD</span>: <span class="string"><span class="content">supersecret</span></span>
<span class="key">mywildfly</span>:
  <span class="key">image</span>: <span class="string"><span class="content">[classroom.example.com:5000|arungupta]/wildfly-mysql-javaee7</span></span>
  <span class="key">links</span>:
    - <span class="string"><span class="content">mysqldb:db</span></span>
  <span class="key">ports</span>:
    - <span class="string"><span class="content">8080</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file is available in <a href="https://raw.githubusercontent.com/redhat-developer/docker-java/javaone2015/attendees/" class="bare">https://raw.githubusercontent.com/redhat-developer/docker-java/javaone2015/attendees/</a> and shows:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Two services defined by the name <code>mysqldb</code> and <code>mywildfly</code></p>
</li>
<li>
<p>Image name for each service defined using <code>image</code></p>
</li>
<li>
<p>Environment variables for the MySQL container are defined in <code>environment</code></p>
</li>
<li>
<p>MySQL container is linked with WildFly container using <code>links</code></p>
</li>
<li>
<p>Port forwarding is achieved using <code>ports</code></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_start_services">8.3. Start Services</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the <code>docker-compose-internet.yml</code> as <code>docker-compose.yml</code> if you are running from Internet or</p>
</li>
<li>
<p>Save the <code>docker-compose-instructor.yml</code> as <code>docker-compose.yml</code> if you are using images from Instructor.</p>
</li>
<li>
<p>All services can be started, in detached mode, by giving the command:</p>
<div class="literalblock">
<div class="content">
<pre>docker-compose up -d</pre>
</div>
</div>
<div class="paragraph">
<p>And this shows the output as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Creating attendees_mysqldb_1...
Creating attendees_mywildfly_1...</pre>
</div>
</div>
<div class="paragraph">
<p>An alternate compose file name can be specified using <code>-f</code>.</p>
</div>
<div class="paragraph">
<p>An alternate directory where the compose file exists can be specified using <code>-p</code>.</p>
</div>
</li>
<li>
<p>Started services can be verified as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker-compose ps
        Name                       Command               State                Ports
-------------------------------------------------------------------------------------------------
attendees_mysqldb_1     /entrypoint.sh mysqld            Up      3306/tcp
attendees_mywildfly_1   /opt/jboss/wildfly/customi ...   Up      0.0.0.0:32773-&gt;8080/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides a consolidated view of all the services started, and containers within them.</p>
</div>
<div class="paragraph">
<p>Alternatively, the containers in this application, and any additional containers running on this Docker host can be verified by using the usual <code>docker ps</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker ps
CONTAINER ID        IMAGE                                    COMMAND                CREATED             STATUS              PORTS                              NAMES
3598e545bd2f        arungupta/wildfly-mysql-javaee7:latest   &quot;/opt/jboss/wildfly/   59 seconds ago      Up 58 seconds       0.0.0.0:32773-&gt;8080/tcp         attendees_mywildfly_1
b8cf6a3d518b        mysql:latest                             &quot;/entrypoint.sh mysq   2 minutes ago       Up 2 minutes        3306/tcp                        attendees_mysqldb_1</code></pre>
</div>
</div>
</li>
<li>
<p>Service logs can be seen as:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker-compose logs
Attaching to attendees_mywildfly_1, attendees_mysqldb_1
mywildfly_1 | =&gt; Starting WildFly server
mywildfly_1 | =&gt; Waiting for the server to boot
mywildfly_1 | =========================================================================
mywildfly_1 |
mywildfly_1 |   JBoss Bootstrap Environment
mywildfly_1 |
mywildfly_1 |   JBOSS_HOME: /opt/jboss/wildfly
mywildfly_1 |
mywildfly_1 |   JAVA: /usr/lib/jvm/java/bin/java
mywildfly_1 |
mywildfly_1 |   JAVA_OPTS:  -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true
mywildfly_1 |

. . .

mywildfly_1 | 15:40:20,866 INFO  [org.jboss.resteasy.spi.ResteasyDeployment] (MSC service thread 1-2) Deploying javax.ws.rs.core.Application: class org.javaee7.samples.employees.MyApplication
mywildfly_1 | 15:40:20,914 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) JBAS017534: Registered web context: /employees
mywildfly_1 | 15:40:21,032 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 28) JBAS018559: Deployed &quot;employees.war&quot; (runtime-name : &quot;employees.war&quot;)
mywildfly_1 | 15:40:21,077 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://127.0.0.1:9990/management
mywildfly_1 | 15:40:21,077 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://127.0.0.1:9990
mywildfly_1 | 15:40:21,077 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.2.0.Final &quot;Tweek&quot; started in 9572ms - Started 280 of 334 services (92 services are lazy, passive or on-demand)
mysqldb_1   | Running mysql_install_db
mysqldb_1   | 2015-06-05 15:38:31 0 [Note] /usr/sbin/mysqld (mysqld 5.6.25) starting as process 27 ...
mysqldb_1   | 2015-06-05 15:38:31 27 [Note] InnoDB: Using atomics to ref count buffer pool pages

. . .

mysqldb_1   | 2015-06-05 15:38:40 1 [Note] Event Scheduler: Loaded 0 events
mysqldb_1   | 2015-06-05 15:38:40 1 [Note] mysqld: ready for connections.
mysqldb_1   | Version: '5.6.25'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  MySQL Community Server (GPL)
mysqldb_1   | 2015-06-05 15:40:18 1 [Warning] IP address '172.17.0.24' could not be resolved: Name or service not known</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_verify_application">8.4. Verify Application</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the application at <a href="http://dockerhost:32773/employees/resources/employees/" class="bare">http://dockerhost:32773/employees/resources/employees/</a>. This is shown in the browser as:</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Use the port displayed in the <code>docker-compose ps</code> command.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/docker-compose-output.png" alt="docker compose output">
</div>
<div class="title">Figure 25. Output From Servers Run Using Docker Compose</div>
</div>
</div>
<div class="sect2">
<h3 id="_scale_services">8.5. Scale Services</h3>
<div class="paragraph">
<p>TODO Improve the explanation</p>
</div>
<div class="paragraph">
<p>You can scale the services up as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose scale mywildfly=4
Creating and starting 2... done
Creating and starting 3... done
Creating and starting 4... done</pre>
</div>
</div>
<div class="paragraph">
<p>Check the logs&#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose logs</pre>
</div>
</div>
<div class="paragraph">
<p>Check the running instances:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose ps</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">       Name                     Command               State            Ports
-------------------------------------------------------------------------------------
rafael_mysqldb_1     /entrypoint.sh mysqld            Up      3306/tcp
rafael_mywildfly_1   /opt/jboss/wildfly/customi ...   Up      0.0.0.0:32773-&gt;8080/tcp
rafael_mywildfly_2   /opt/jboss/wildfly/customi ...   Up      0.0.0.0:32777-&gt;8080/tcp
rafael_mywildfly_3   /opt/jboss/wildfly/customi ...   Up      0.0.0.0:32780-&gt;8080/tcp
rafael_mywildfly_4   /opt/jboss/wildfly/customi ...   Up      0.0.0.0:32781-&gt;8080/tcp</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also decide to reduce the number of running instances:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose scale mywildfly=2
Stopping rafael_mywildfly_3... done
Stopping rafael_mywildfly_4... done
Removing rafael_mywildfly_3... done
Removing rafael_mywildfly_4... done</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stop_services">8.6. Stop Services</h3>
<div class="paragraph">
<p>Stop the services as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose stop
Stopping attendees_mywildfly_1...
Stopping attendees_mywildfly_2...
Stopping attendees_mysqldb_1...</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Stopping and starting the containers again will give the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">wildfly_1 |
wildfly_1 | 09:11:07,802 ERROR [org.jboss.as.controller.management-operation] (management-handler-thread - 4) JBAS014613: Operation (&quot;add&quot;) failed - address: ([
wildfly_1 |     (&quot;subsystem&quot; =&gt; &quot;datasources&quot;),
wildfly_1 |     (&quot;jdbc-driver&quot; =&gt; &quot;mysql&quot;)
wildfly_1 | ]) - failure description: &quot;JBAS014803: Duplicate resource [
wildfly_1 |     (\&quot;subsystem\&quot; =&gt; \&quot;datasources\&quot;),
wildfly_1 |     (\&quot;jdbc-driver\&quot; =&gt; \&quot;mysql\&quot;)
wildfly_1 | ]&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is expected because the JDBC resource is created during every run of the container. In a real-world application, this would be pre-baked in the configuration already.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_remove_containers">8.7. Remove Containers</h3>
<div class="paragraph">
<p>Stop the services as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose rm
Going to remove rafael_mywildfly_4, rafael_mywildfly_3, rafael_mywildfly_2, rafael_mywildfly_1, rafael_mysqldb_1
Are you sure? [yN] y
Removing rafael_mywildfly_2... done
Removing rafael_mywildfly_1... done
Removing rafael_mysqldb_1... done</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Docker_Swarm">9. Java EE Application on Docker Swarm Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Docker Swarm is native clustering for Docker. It allows you create and access to a pool of Docker hosts using the full suite of Docker tools. Because Docker Swarm serves the standard Docker API, any tool that already communicates with a Docker daemon can use Swarm to transparently scale to multiple hosts</p>
</div>
<div class="sect2">
<h3 id="_key_components_of_docker_swarm">9.1. Key Components of Docker Swarm</h3>
<div class="imageblock">
<div class="content">
<img src="chapters/images/docker-swarm-components.png" alt="docker swarm components">
</div>
<div class="title">Figure 26. Key Components of Docker Swarm</div>
</div>
<div class="paragraph">
<p><strong>Swarm Manager</strong>: Docker Swarm has a Manager, that is a pre-defined Docker Host, and is a single point for all administration. The swarm manager orchestrates and schedules containers on the entire cluster. Currently only a single instance of manager is allowed in the cluster. This is a SPOF for high availability architectures and additional managers will be allowed in a future version of Swarm with <a href="https://github.com/docker/swarm/issues/598">#598</a>.</p>
</div>
<div class="paragraph">
<p><strong>Swarm Nodes</strong>: The containers are deployed on Nodes that are additional Docker Hosts. Each Swarm Node must be accessible by the manager, each node must listen to the same network interface (TCP port). Each node runs a Docker Swarm agent that registers the referenced Docker daemon, monitors it, and updates the discovery backend with the node’s status. The containers run on a node.</p>
</div>
<div class="paragraph">
<p><strong>Scheduler Strategy</strong>: Different scheduler strategies (&#8220;binpack&#8221;, &#8220;spread&#8221; (default), and &#8220;random&#8221;) can be applied to pick the best node to run your container. The default strategy optimizes the node for least number of running containers. There are multiple kinds of filters, such as constraints and affinity.  This should allow for a decent scheduling algorithm.</p>
</div>
<div class="paragraph">
<p><strong>Node Discovery Service</strong>: By default, Swarm uses hosted discovery service, based on Docker Hub, using tokens to discover nodes that are part of a cluster. However etcd, consul, and ZooKeeper can be also be used for service discovery as well. This is particularly useful if there is no access to Internet, or you are running the setup in a closed network. A new discovery backend can be created as explained here. It would be useful to have the hosted Discovery Service inside the firewall and <a href="https://github.com/docker/swarm/issues/660">#660</a> will discuss this.</p>
</div>
<div class="paragraph">
<p><strong>Standard Docker API:</strong> Docker Swarm serves the standard Docker API and thus any tool that talks to a single Docker host will seamlessly scale to multiple hosts now. That means that if you were using shell scripts using Docker CLI to configure multiple Docker hosts, the same CLI would can now talk to Swarm cluster and Docker Swarm will then act as proxy and run it on the cluster.</p>
</div>
<div class="paragraph">
<p>There are lots of other concepts but these are the main ones.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_docker_swarm_cluster">9.2. Create a Docker Swarm Cluster</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The easiest way of using Swarm is, by using the official Docker image:</p>
<div class="literalblock">
<div class="content">
<pre>#From Internet
docker run --rm swarm create</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>#From Instructor
docker run --rm classroom.example.com:5000/swarm create</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This command returns a discovery token, referred as &lt;TOKEN&gt; in this document, and is the unique cluster id. It will be used when creating master and nodes later. This cluster id is returned by the hosted discovery service on Docker Hub.</p>
</div>
<div class="paragraph">
<p>It shows the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Unable to find image 'swarm:latest' locally
latest: Pulling from swarm
55b38848634f: Pull complete
fd7bc7d11a30: Pull complete
db039e91413f: Pull complete
1e5a49ab6458: Pull complete
5d9ce3cdadc7: Pull complete
1f26e949f933: Pull complete
e08948058bed: Already exists
swarm:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.
Digest: sha256:0e417fe3f7f2c7683599b94852e4308d1f426c82917223fccf4c1c4a4eddb8ef
Status: Downloaded newer image for swarm:latest
1d528bf0568099a452fef5c029f39b85</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
The last line is the &lt;TOKEN&gt;.</p>
</div>
<div class="paragraph">
<p>+
NOTE: Make sure to note this cluster id now as there is no means to list it later. This should be fixed with <a href="https://github.com/docker/swarm/issues/661">#661</a>.</p>
</div>
<div class="paragraph">
<p>+
. Swarm is fully integrated with Docker Machine, and so is the easiest way to get started. Let&#8217;s create a Swarm Master next:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker-machine create -d virtualbox --swarm --swarm-master --swarm-discovery token://&lt;token&gt; swarm-master

#From Instructor
docker-machine create -d virtualbox --virtualbox-boot2docker-url=http://classroom.example.com:8082/downloads/boot2docker.iso --engine-insecure-registry=classroom.example.com:5000 --swarm --swarm-master --swarm-discovery token://&lt;token&gt; swarm-master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;TOKEN&gt;</code> with the cluster id obtained in the previous step.</p>
</div>
<div class="paragraph">
<p><code>--swarm</code> configures the machine with Swarm, <code>--swarm-master</code> configures the created machine to be Swarm master. Swarm master creation talks to the hosted service on Docker Hub and informs that a master is created in the cluster.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to this newly created master and find some more information about it:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">eval &quot;$(docker-machine env swarm-master)&quot;
docker info</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
NOTE: If you&#8217;re on Windows, use the <code>docker-machine env swarm-master</code> command only and copy the output into an editor to replace all appearances of EXPORT with SET and issue the three commands at your command prompt, remove the quotes and all duplicate appearences of "/".</p>
</div>
<div class="paragraph">
<p>+
This will show the output as:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker info
Containers: 2
Images: 7
Storage Driver: aufs
 Root Dir: /mnt/sda1/var/lib/docker/aufs
 Backing Filesystem: extfs
 Dirs: 11
 Dirperm1 Supported: true
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 4.0.5-boot2docker
Operating System: Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015
CPUs: 1
Total Memory: 996.2 MiB
Name: swarm-master
ID: DLFR:OQ3E:B5P6:HFFD:VKLI:IOLU:URNG:HML5:UHJF:6JCL:ITFH:DS6J
Debug mode (server): true
File Descriptors: 22
Goroutines: 36
System Time: 2015-07-11T00:16:34.29965306Z
EventsListeners: 1
Init SHA1:
Init Path: /usr/local/bin/docker
Docker Root Dir: /mnt/sda1/var/lib/docker
Username: arungupta
Registry: https://index.docker.io/v1/
Labels:
 provider=virtualbox</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Swarm node</p>
<div class="literalblock">
<div class="content">
<pre>#From Internet
docker-machine create -d virtualbox --swarm --swarm-discovery token://&lt;TOKEN&gt; swarm-node-01</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>#From Instructor
docker-machine create -d virtualbox --virtualbox-boot2docker-url=http://classroom.example.com:8082/downloads/boot2docker.iso --engine-insecure-registry=classroom.example.com:5000 --swarm --swarm-discovery token://&lt;TOKEN&gt; swarm-node-01</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Replace <code>&lt;TOKEN&gt;</code> with the cluster id obtained in an earlier step.</p>
</div>
<div class="paragraph">
<p>Node creation talks to the hosted service at Docker Hub and joins the previously created cluster. This is specified by <code>--swarm-discovery token://&#8230;&#8203;</code> and specifying the cluster id obtained earlier.
. To make it a real cluster, let&#8217;s create a second node:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>#From Internet
docker-machine create -d virtualbox --swarm --swarm-discovery token://&lt;TOKEN&gt; swarm-node-02</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>#From Instructor
docker-machine create -d virtualbox --virtualbox-boot2docker-url=http://classroom.example.com:8082/downloads/boot2docker.iso --engine-insecure-registry=classroom.example.com:5000 --swarm --swarm-discovery token://&lt;TOKEN&gt; swarm-node-02</pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;TOKEN&gt;</code> with the cluster id obtained in the previous step.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List all the nodes created so far:</p>
<div class="literalblock">
<div class="content">
<pre>docker-machine ls</pre>
</div>
</div>
<div class="paragraph">
<p>This shows the output similar to the one below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker-machine ls
NAME            ACTIVE   DRIVER       STATE     URL                         SWARM
lab                      virtualbox   Running   tcp://192.168.99.101:2376
swarm-master    *        virtualbox   Running   tcp://192.168.99.102:2376   swarm-master (master)
swarm-node-01            virtualbox   Running   tcp://192.168.99.103:2376   swarm-master
swarm-node-02            virtualbox   Running   tcp://192.168.99.104:2376   swarm-master</code></pre>
</div>
</div>
<div class="paragraph">
<p>The machines that are part of the cluster have the cluster’s name in the SWARM column, blank otherwise. For example, &#8220;lab&#8221; and &#8220;summit2015&#8221; are standalone machines where as all other machines are part of the &#8220;swarm-master&#8221; cluster. The Swarm master is also identified by (master) in the SWARM column.</p>
</div>
</li>
<li>
<p>Connect to the Swarm cluster and find some information about it:</p>
<div class="literalblock">
<div class="content">
<pre>eval "$(docker-machine env --swarm swarm-master)"
docker info</pre>
</div>
</div>
<div class="paragraph">
<p>This shows the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker info
Containers: 4
Images: 3
Role: primary
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 3
 swarm-master: 192.168.99.102:2376
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-01: 192.168.99.103:2376
  └ Containers: 1
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-02: 192.168.99.104:2376
  └ Containers: 1
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
CPUs: 3
Total Memory: 3.065 GiB</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are 3 nodes – one Swarm master and 2 Swarm nodes. There is a total of 4 containers running in this cluster – one Swarm agent on master and each node, and there is an additional swarm-agent-master running on the master. This can be verified by connecting to the master and listing all the containers.</p>
</div>
</li>
<li>
<p>List nodes in the cluster with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker run swarm list token://&lt;TOKEN&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; docker run swarm list token://1d528bf0568099a452fef5c029f39b85
192.168.99.103:2376
192.168.99.104:2376
192.168.99.102:2376</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_java_ee_application_to_docker_swarm_cluster">9.3. Deploy Java EE Application to Docker Swarm Cluster</h3>
<div class="paragraph">
<p>The complete cluster is in place now, and we need to deploy the Java EE application to it.</p>
</div>
<div class="paragraph">
<p>Swarm takes care for the distribution of deployments across the nodes. The only thing, we need to do is to deploy the application as already explained in <a href="#JavaEE7_Container_Linking">Deploy Java EE 7 Application (Container Linking)</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start MySQL server as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run --name mysqldb -e MYSQL_USER=mysql -e MYSQL_PASSWORD=mysql -e MYSQL_DATABASE=sample -e MYSQL_ROOT_PASSWORD=supersecret -p 3306:3306 -d mysql

#From Instructor
docker run --name mysqldb -e MYSQL_USER=mysql -e MYSQL_PASSWORD=mysql -e MYSQL_DATABASE=sample -e MYSQL_ROOT_PASSWORD=supersecret -p 3306:3306 -d classroom.example.com:5000/mysql</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-e</code> define environment variables that are read by the database at startup and allow us to access the database with this user and password.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start WildFly and deploy Java EE 7 application as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">#From Internet
docker run -d --name mywildfly --link mysqldb:db -p 8080:8080 arungupta/wildfly-mysql-javaee7

#From Instructor
docker run -d --name mywildfly --link mysqldb:db -p 8080:8080 classroom.example.com:5000/wildfly-mysql-javaee7</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is using the <a href="https://docs.docker.com/userguide/dockerlinks/">Docker Container Linking</a> explained earlier.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check state of the cluster as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; docker info
Containers: 7
Images: 5
Role: primary
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 3
 swarm-master: 192.168.99.102:2376
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-01: 192.168.99.103:2376
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-02: 192.168.99.104:2376
  └ Containers: 3
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
CPUs: 3
Total Memory: 3.065 GiB</pre>
</div>
</div>
<div class="paragraph">
<p>&#8220;swarm-node-02&#8221; is running three containers and so lets look at the list of running containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">&gt; eval &quot;$(docker-machine env swarm-node-02)&quot;
&gt; docker ps -a
CONTAINER ID        IMAGE                             COMMAND                CREATED             STATUS              PORTS                     NAMES
35325d730c97        arungupta/wildfly-mysql-javaee7   &quot;/opt/jboss/wildfly/   57 seconds ago      Up 56 seconds       0.0.0.0:32768-&gt;8080/tcp   rafael_mywildfly_1
dd3525575b12        mysql                             &quot;/entrypoint.sh mysq   57 seconds ago      Up 56 seconds       3306/tcp                  rafael_mysqldb_1
e9f655cbcb4b        swarm:latest                      &quot;/swarm join --adver   27 minutes ago      Up 27 minutes       2375/tcp                  swarm-agent</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the application as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">curl http://$(docker-machine ip swarm-node-02):8080/employees/resources/employees</code></pre>
</div>
</div>
<div class="paragraph">
<p>to see the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span><span class="tag">&lt;collection&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>1<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Penny<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>2<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Sheldon<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>3<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Amy<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>4<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Leonard<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>5<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Bernadette<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>6<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Raj<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>7<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Howard<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;employee&gt;</span><span class="tag">&lt;id&gt;</span>8<span class="tag">&lt;/id&gt;</span><span class="tag">&lt;name&gt;</span>Priya<span class="tag">&lt;/name&gt;</span><span class="tag">&lt;/employee&gt;</span><span class="tag">&lt;/collection&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_java_ee_application_to_docker_swarm_cluster_using_docker_compose">9.4. Deploy Java EE Application to Docker Swarm Cluster using Docker Compose</h3>
<div class="paragraph">
<p><a href="#Docker_Compose">Multiple Containers Using Docker Compose</a> explains how multi container applications can be easily started using Docker Compose.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to &#8216;swarm-node-02&#8217;:</p>
<div class="literalblock">
<div class="content">
<pre>eval "$(docker-machine env swarm-node-02)"</pre>
</div>
</div>
</li>
<li>
<p>Stop the MySQL and WildFly containers:</p>
<div class="literalblock">
<div class="content">
<pre>docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f
docker ps -a | grep mysql | awk '{print $1}' | xargs docker rm -f</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>docker-compose.yml</code> file explained in <a href="#Docker_Compose">Multiple Containers Using Docker Compose</a> to start the containers as:</p>
<div class="literalblock">
<div class="content">
<pre>docker-compose up -d
Creating wildflymysqljavaee7_mysqldb_1...
Creating wildflymysqljavaee7_mywildfly_1...</pre>
</div>
</div>
</li>
<li>
<p>Check the containers running in the cluster as:</p>
<div class="literalblock">
<div class="content">
<pre>eval "$(docker-machine env --swarm swarm-master)"
docker info</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>to see the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker info
Containers: 7
Images: 5
Role: primary
Strategy: spread
Filters: affinity, health, constraint, port, dependency
Nodes: 3
 swarm-master: 192.168.99.102:2376
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-01: 192.168.99.103:2376
  └ Containers: 2
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
 swarm-node-02: 192.168.99.104:2376
  └ Containers: 3
  └ Reserved CPUs: 0 / 1
  └ Reserved Memory: 0 B / 1.022 GiB
  └ Labels: executiondriver=native-0.2, kernelversion=4.0.5-boot2docker, operatingsystem=Boot2Docker 1.7.0 (TCL 6.3); master : 7960f90 - Thu Jun 18 18:31:45 UTC 2015, provider=virtualbox, storagedriver=aufs
CPUs: 3
Total Memory: 3.065 GiB</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to &#8216;swarm-node-02&#8217; again:</p>
<div class="literalblock">
<div class="content">
<pre>eval "$(docker-machine env swarm-node-02)"</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>and see the list of running containers as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker ps -a
CONTAINER ID        IMAGE                             COMMAND                CREATED             STATUS              PORTS                     NAMES
35325d730c97        arungupta/wildfly-mysql-javaee7   &quot;/opt/jboss/wildfly/   57 seconds ago      Up 56 seconds       0.0.0.0:32768-&gt;8080/tcp   rafael_mywildfly_1
dd3525575b12        mysql                   &quot;/entrypoint.sh mysq   57 seconds ago      Up 56 seconds       3306/tcp                  rafael_mysqldb_1
e9f655cbcb4b        swarm:latest                      &quot;/swarm join --adver   27 minutes ago      Up 27 minutes       2375/tcp                  swarm-agent</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the logs</p>
<div class="literalblock">
<div class="content">
<pre>docker-compose logs</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Add container visualiation using <a href="https://github.com/javaee-samples/docker-java/issues/55" class="bare">https://github.com/javaee-samples/docker-java/issues/55</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Common_Docker_Commands">10. Common Docker Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is the list of commonly used Docker commands:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Image</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker build --rm=true .</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker pull ${IMAGE}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of installed images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker images</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of installed images (detailed listing)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker images --no-trunc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi ${IMAGE_ID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all untagged images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi $(docker images | grep “^” | awk “{print $3}”)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm $(docker ps -aq)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove dangling images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi $(docker images --quiet --filter "dangling=true")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Containers</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker run</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of running containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of all containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker stop ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop all running containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker stop <code>docker ps -q</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all exited containers with status 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a --filter "exited=1"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove container by a regular expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all exited containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm -f $(docker ps -a | grep Exit | awk '{ print $1 }')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm $(docker ps -aq)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find IP address of the container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker inspect --format '{{ .NetworkSettings.IPAddress }}' ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attach to a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker attach ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open a shell in to a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker exec -it ${CID} bash</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get container id for an image by a regular expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps | grep wildfly | awk '{print $1}'</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">11. Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_can_t_resolve_classroom_example_com">11.1. Can&#8217;t resolve classroom.example.com</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure to add the instructor IP as DNS server to your system</p>
</li>
<li>
<p>On Windows temporarily disable IPv6 (we&#8217;re only supporting IPv4)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_network_timed_out">11.2. Network Timed Out</h3>
<div class="paragraph">
<p>Depending upon the network speed and restrictions, you may not be able to download Docker images from Docker Hub. The error message may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker pull arungupta/wildfly-mysql-javaee7
Using default tag: latest
Pulling repository docker.io/arungupta/wildfly-mysql-javaee7
Network timed out while trying to connect to https://index.docker.io/v1/repositories/arungupta/wildfly-mysql-javaee7/images. You may want to check your internet connection or if you are behind a proxy.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This section provide a couple of alternatives to solve this.</p>
</div>
<div class="sect3">
<h4 id="_restart_docker_machine">11.2.1. Restart Docker Machine</h4>
<div class="paragraph">
<p>It seems like Docker Machine gets into a strange state and restarting it fixes that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker-machine restart &lt;MACHINE_NAME&gt;
eval $(docker-machine env &lt;MACHINE_NAME&gt;)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loading_images_offline">11.2.2. Loading Images Offline</h4>
<div class="paragraph">
<p>Images can be downloaded from a previously saved <code>.tar</code> file. All images required for this workshop can be downloaded from:</p>
</div>
<div class="paragraph">
<p><a href="https://drive.google.com/folderview?id=0B8g4lYJ4uB37RkdqbFpPZU5ZS2s&amp;usp=sharing" class="bare">https://drive.google.com/folderview?id=0B8g4lYJ4uB37RkdqbFpPZU5ZS2s&amp;usp=sharing</a></p>
</div>
<div class="paragraph">
<p>Load the tar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker load -i &lt;path to image tar file&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker load -i arungupta-javaee7-hol.tar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>docker images</code> should show the image.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cannot_create_docker_machine_on_windows">11.3. Cannot create Docker Machine on Windows</h3>
<div class="paragraph">
<p>Double check, that you have the correct version of VirtualBox installed.
Clear all host-adapter interfaces in Virtualbox before creating a new machine.
Make sure to have git for windows in your path.</p>
</div>
<div class="paragraph">
<p>Are you not able to create Docker Machine on Windows?</p>
</div>
<div class="paragraph">
<p>Try starting a <code>cmd</code> with Administrator privileges and then give the command again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_no_route_to_host">11.4. No route to host</h3>
<div class="paragraph">
<p>Accessing the WildFly and MySQL sample in Kubernetes gives 404 when you give the command <code>curl <a href="http://10.246.1.23:8080/employees/resources/employees/" class="bare">http://10.246.1.23:8080/employees/resources/employees/</a></code>.</p>
</div>
<div class="paragraph">
<p>This may be resolved by stopping the node and restarting the cluster again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">vagrant halt minion-1
./cluster/kube-up.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>These commands need to be given in the &#8216;kubernetes&#8217; directory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">12. References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Docker Docs: <a href="http://docs.docker.com" class="bare">http://docs.docker.com</a></p>
</li>
<li>
<p>Kubernetes Docs: <a href="https://github.com/kubernetes/kubernetes/tree/master/docs" class="bare">https://github.com/kubernetes/kubernetes/tree/master/docs</a></p>
</li>
<li>
<p>JBoss and Docker: <a href="http://www.jboss.org/docker/" class="bare">http://www.jboss.org/docker/</a></p>
</li>
<li>
<p>Latest lab content: <a href="https://github.com/javaee-samples/docker-java" class="bare">https://github.com/javaee-samples/docker-java</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-10-13 19:00:17 EDT
</div>
</div>
</body>
</html>