<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="v1.5-devnexus2017, Feb 12, 2017">
<title>Docker for Java Developers</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article">
<div id="header">
<h1>Docker for Java Developers</h1>
<div class="details">
<span id="author" class="author">v1.5-devnexus2017, Feb 12, 2017</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Latest HTML:
<a href="http://htmlpreview.github.io/?https://github.com/redhat-developer-demos/docker-java/blob/devnexus2017/readme.html" class="bare">http://htmlpreview.github.io/?https://github.com/redhat-developer-demos/docker-java/blob/devnexus2017/readme.html</a></p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a></li>
<li><a href="#_setup_environment_in_gce">Setup Environment in GCE</a></li>
<li><a href="#Docker_Basics">Docker Basics</a>
<ul class="sectlevel2">
<li><a href="#_docker_client">Docker Client</a></li>
</ul>
</li>
<li><a href="#_run_container">Run Container</a>
<ul class="sectlevel2">
<li><a href="#_pull_image">Pull Image</a></li>
<li><a href="#_run_container_2">Run Container</a>
<ul class="sectlevel3">
<li><a href="#_interactive_container">Interactive Container</a></li>
<li><a href="#_detached_container">Detached Container</a></li>
</ul>
</li>
<li><a href="#_run_container_with_default_port">Run Container with Default Port</a></li>
<li><a href="#_run_container_with_specified_port">Run Container with Specified Port</a></li>
<li><a href="#_stop_container">Stop Container</a></li>
<li><a href="#_remove_container">Remove Container</a></li>
<li><a href="#Enabling_WildFly_Administration">Enabling WildFly Administration</a>
<ul class="sectlevel3">
<li><a href="#_default_port_mapping">Default Port Mapping</a></li>
<li><a href="#Management_Fixed_Port_Mapping">Fixed Port Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_build_an_image">Build an Image</a>
<ul class="sectlevel2">
<li><a href="#_dockerfile">Dockerfile</a></li>
<li><a href="#_create_your_first_docker_image">Create your first Docker image</a></li>
<li><a href="#_wildfly_image">WildFly Image</a></li>
<li><a href="#_import_and_export_images">Import and export images</a></li>
</ul>
</li>
<li><a href="#JavaEE_PreBuilt_WAR">Deploy Java EE Application (Pre-Built WAR)</a></li>
<li><a href="#JavaEE_Docker_Network">Deploy Java EE  Application (Docker Network)</a></li>
<li><a href="#_build_and_deploy_java_ee_application">Build and Deploy Java EE Application</a>
<ul class="sectlevel2">
<li><a href="#Build_Application">Build Application</a></li>
<li><a href="#_start_application_server">Start Application Server</a></li>
<li><a href="#_deploy_application_using_cli">Deploy Application Using CLI</a>
<ul class="sectlevel3">
<li><a href="#_wildfly">WildFly</a></li>
<li><a href="#_cli">CLI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Common_Docker_Commands">Common Docker Commands</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_can_t_resolve_classroom_example_com">Can&#8217;t resolve classroom.example.com</a></li>
<li><a href="#_network_timed_out">Network Timed Out</a>
<ul class="sectlevel3">
<li><a href="#_restart_docker_machine">Restart Docker Machine</a></li>
<li><a href="#_loading_images_offline">Loading Images Offline</a></li>
</ul>
</li>
<li><a href="#_cannot_create_docker_machine_on_windows">Cannot create Docker Machine on Windows</a></li>
<li><a href="#_no_route_to_host">No route to host</a></li>
<li><a href="#_docker_machine_creation_fails_with_an_error_about_dial_tcp_i_o_timeout">Docker machine creation fails with an error about dial tcp: i/o timeout</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface">Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Containers are enabling developers to package their applications (and underlying dependencies) in new ways that are portable and work consistently everywhere. On your machine, in production, in your data center, and in the cloud. And Docker has become the de facto standard for those portable containers in the cloud.</p>
</div>
<div class="paragraph">
<p>Docker is the developer-friendly Linux container technology that enables creation of your stack: OS, JVM, app server, app, and all your custom configuration. So with all it offers, how comfortable are you and your team taking Docker from development to production? Are you hearing developers say, “But it works on my machine!” when code breaks in production?</p>
</div>
<div class="paragraph">
<p>This lab offers developers an intro-level, hands-on session with Docker, from installation, to exploring Docker Hub, to crafting their own images, to adding Java apps and running custom containers. It will also explain how to use Swarm to orchesorchestrate these containers together. This is a BYOL (bring your own laptop) session, so bring your Windows, OSX, or Linux laptop and be ready to dig into a tool that promises to be at the forefront of our industry for some time to come.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Latest content of this lab is always at <a href="https://github.com/redhat-developer/docker-java" class="bare">https://github.com/redhat-developer/docker-java</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_environment_in_gce">Setup Environment in GCE</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The instructor will provide you with a temporary username / password to login into Google Cloud Console.</p>
</li>
<li>
<p>To avoid conflicts with your personal account, please open a new incognito window for the rest of this lab.</p>
</li>
<li>
<p>Login into the Cloud Console: <a href="https://console.cloud.google.com/" class="bare">https://console.cloud.google.com/</a> with the provided credentials.</p>
</li>
<li>
<p>Accept the terms of service, and also configure the E-Mail preferences</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-license.png" alt="gce license">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure you click on the project someproject-XXXX that was pre-created for you - this is also your Project ID.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-project.png" alt="gce project">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Visit each of these pages to kick-off some initial setup behind the scenes, such as enabling the Compute Engine API by navigating to Compute → Compute Engine → VM Instances</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-menu.png" alt="gce menu">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will see the "Compute Engine is getting ready" message. Wait until this is done.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-getting-ready.png" alt="gce getting ready">
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s create our Google Compute instance.
Open the Google Cloud Shell by clicking on the icon on the top right of the screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-shell.png" alt="gce shell">
</div>
</div>
<div class="paragraph">
<p>Click Start <strong>Cloud Shell</strong></p>
</div>
<div class="paragraph">
<p>In the Google Cloud Shell type the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ gcloud compute instances create --image-family=centos-7 --image-project=centos-cloud --machine-type n1-standard-2 --zone us-east1-b --boot-disk-size=200GB mydocker-daemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will take some seconds to complete.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-shell2.png" alt="gce shell2">
</div>
</div>
<div class="paragraph">
<p>Once the command completes, you should see a Virtual Computer called "mydocker-daemon" created. Click in the SSH link.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/gce-vminstance.png" alt="gce vminstance">
</div>
</div>
<div class="paragraph">
<p>When you click on <strong>SSH</strong>, a web shell will be opened. Now, we will setup our CentOS Linux to run a docker daemon.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do it. Execute the following commands in the <em><strong>mydocker-daemon SSH terminal</strong></em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ sudo su -

# Installing docker and other tools
$ yum install -y docker git wget maven unzip

$ systemctl enable docker; systemctl start docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check if the client is working by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will return an empty list of containers working.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Docker_Basics">Docker Basics</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>PURPOSE</strong>: This chapter introduces the basic terminology of Docker.</p>
</div>
<div class="quoteblock">
<blockquote>
Docker is a platform for developers and sysadmins to develop, ship, and run applications. Docker lets you quickly assemble applications from components and eliminates the friction that can come when shipping code. Docker lets you get your code tested and deployed into production as fast as possible.
</blockquote>
<div class="attribution">
&#8212; docs.docker.com/
</div>
</div>
<div class="paragraph">
<p>Docker simplifies software delivery by making it easy to build and share images that contain your application’s entire environment, or <em>application operating system</em>.</p>
</div>
<div class="paragraph">
<p><strong>What does it mean by an application operating system ?</strong></p>
</div>
<div class="paragraph">
<p>Your application typically require a specific version of operating system, application server, JDK, database server, may require to tune the configuration files, and similarly multiple other dependencies. The application may need binding to specific ports and certain amount of memory. The components and configuration together required to run your application is what is referred to as application operating system.</p>
</div>
<div class="paragraph">
<p>You can certainly provide an installation script that will download and install these components. Docker simplifies this process by allowing to create an image that contains your application and infrastructure together, managed as one component. These images are then used to create Docker containers which run on the container virtualization platform, provided by Docker.</p>
</div>
<div class="paragraph">
<p><strong>Main Components of Docker</strong></p>
</div>
<div class="paragraph">
<p>Docker has three main components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Images</em> are <strong>build component</strong> of Docker and a read-only template of application operating system.</p>
</li>
<li>
<p><em>Containers</em> are <strong>run component</strong> of Docker, and created from, images.Containers can be run, started, stopped, moved, and deleted.</p>
</li>
<li>
<p>Images are stored, shared, and managed in a <em>registry</em>, the <strong>distribution component</strong> of Docker. The publically available registry is known as Docker Hub (available at <a href="http://hub.docker.com" class="bare">http://hub.docker.com</a>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In order for these three components to work together, there is <strong>Docker Daemon</strong> that runs on a host machine and does the heavy lifting of building, running, and distributing Docker containers. In addition, there is <strong>Client</strong> that is a Docker binary which accepts commands from the user and communicates back and forth with the daemon.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/docker-architecture.png" alt="docker architecture">
</div>
<div class="title">Figure 1. Docker architecture</div>
</div>
<div class="paragraph">
<p>Client communicates with Daemon, either co-located on the same host, or on a different host. It requests the Daemon to pull an image from the repository using <code>pull</code> command. The Daemon then downloads the image from Docker Hub, or whatever registry is configured. Multiple images can be downloaded from the registry and installed on Daemon host. Images are run using <code>run</code> command to create containers on demand.</p>
</div>
<div class="paragraph">
<p><strong>How does a Docker Image work?</strong></p>
</div>
<div class="paragraph">
<p>We&#8217;ve already seen that Docker images are read-only templates from which Docker containers are launched. Each image consists of a series of layers. Docker makes use of union file systems to combine these layers into a single image. Union file systems allow files and directories of separate file systems, known as branches, to be transparently overlaid, forming a single coherent file system.</p>
</div>
<div class="paragraph">
<p>One of the reasons Docker is so lightweight is because of these layers. When you change a Docker image—for example, update an application to a new version— a new layer gets built. Thus, rather than replacing the whole image or entirely rebuilding, as you may do with a virtual machine, only that layer is added or updated. Now you don&#8217;t need to distribute a whole new image, just the update, making distributing Docker images faster and simpler.</p>
</div>
<div class="paragraph">
<p>Every image starts from a base image, for example <code>ubuntu</code>, a base Ubuntu image, or <code>fedora</code>, a base Fedora image. You can also use images of your own as the basis for a new image, for example if you have a base Apache image you could use this as the base of all your web application images.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, Docker obtains these base images from Docker Hub.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Docker images are then built from these base images using a simple, descriptive set of steps we call instructions. Each instruction creates a new layer in our image. Instructions include actions like:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run a command</p>
</li>
<li>
<p>Add a file or directory</p>
</li>
<li>
<p>Create an environment variable</p>
</li>
<li>
<p>Run a process when launching a container</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These instructions are stored in a file called a Dockerfile. Docker reads this Dockerfile when you request a build of an image, executes the instructions, and returns a final image.</p>
</div>
<div class="paragraph">
<p><strong>How does a Container work?</strong></p>
</div>
<div class="paragraph">
<p>A container consists of an operating system, user-added files, and meta-data. As we&#8217;ve seen, each container is built from an image. That image tells Docker what the container holds, what process to run when the container is launched, and a variety of other configuration data. The Docker image is read-only. When Docker runs a container from an image, it adds a read-write layer on top of the image (using a union file system as we saw earlier) in which your application can then run.</p>
</div>
<div class="sect2">
<h3 id="_docker_client">Docker Client</h3>
<div class="paragraph">
<p>The client communicates with the demon process on your host and let&#8217;s you work with images and containers.</p>
</div>
<div class="paragraph">
<p>Check if your client is working using the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker -v</pre>
</div>
</div>
<div class="paragraph">
<p>It shows the output similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Docker version 1.12.5, build 047e51b/1.12.5</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The exact version may differ based upon how recently the installation was performed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The most important options you&#8217;ll be using frequently are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>run</code> - runs a container</p>
</li>
<li>
<p><code>ps</code>- lists containers</p>
</li>
<li>
<p><code>stop</code> - stops a container</p>
</li>
<li>
<p><code>rm</code> - Removes a container</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Get a full list of available commands with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker</pre>
</div>
</div>
<div class="paragraph">
<p>A more comprehensive list of commands is also available in <a href="#Common_Docker_Commands">Common Docker Commands</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_container">Run Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first step in running any application on Docker is to run a container from an image. There are plenty of images available from the official Docker registry (aka <a href="https://hub.docker.com">Docker Hub</a>). To run any of them, you just have to ask the Docker Client to run it. The client will check if the image already exists on Docker Host. If it exists then it&#8217;ll run it, otherwise the host will download the image and then run it.</p>
</div>
<div class="sect2">
<h3 id="_pull_image">Pull Image</h3>
<div class="paragraph">
<p>Let&#8217;s first check, if any images are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker images</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first, this list is empty.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">REPOSITORY              TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get a vanilla <code>jboss/wildfly</code> image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker pull jboss/wildfly:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, docker images are retrieved from <a href="https://hub.docker.com/">Docker Hub</a>.</p>
</div>
<div class="paragraph">
<p>You can see, that Docker is downloading the image with it&#8217;s different layers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In a traditional Linux boot, the Kernel first mounts the root File System as read-only, checks its integrity, and then switches the whole rootfs volume to read-write mode.
When Docker mounts the rootfs, it starts read-only, as in a traditional Linux boot, but then, instead of changing the file system to read-write mode, it takes advantage of a union mount to add a read-write file system over the read-only file system. In fact there may be multiple read-only file systems stacked on top of each other. Consider each one of these file systems as a layer.</p>
</div>
<div class="paragraph">
<p>At first, the top read-write layer has nothing in it, but any time a process creates a file, this happens in the top layer. And if something needs to update an existing file in a lower layer, then the file gets copied to the upper layer and changes go into the copy. The version of the file on the lower layer cannot be seen by the applications anymore, but it is there, unchanged.</p>
</div>
<div class="paragraph">
<p>We call the union of the read-write layer and all the read-only layers a <em>union file system</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/plain-wildfly0.png" alt="plain wildfly0">
</div>
<div class="title">Figure 2. Docker Layers</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our particular case, the <a href="https://github.com/jboss-dockerfiles/wildfly/blob/10.0.0.Final/Dockerfile">jboss/wildfly</a> image extends the <a href="https://github.com/jboss-dockerfiles/base-jdk/blob/jdk8/Dockerfile">jboss/base-jdk:8</a> image which adds the OpenJDK distribution on top of the <a href="https://github.com/jboss-dockerfiles/base/blob/master/Dockerfile">jboss/base</a> image.
The base image is used for all JBoss community images. It provides a base layer that includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A jboss user (uid/gid 1000) with home directory set to <code>/opt/jboss</code></p>
</li>
<li>
<p>A few tools that may be useful when extending the image or installing software, like unzip.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The &#8220;jboss/base-jdk:8&#8221; image adds:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>OpenJDK 8 distribution</p>
</li>
<li>
<p>Adds a <code>JAVA_HOME</code> environment variable</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the download is done, you can list the images again and will see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
jboss/wildfly       latest              7688aaf382ab        6 weeks ago         581.4 MB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_2">Run Container</h3>
<div class="paragraph">
<p>For now, all we did is pull the container description (aka image) down to our local laptops. Now we want to actually run an instance of the image as a so called "container".</p>
</div>
<div class="sect3">
<h4 id="_interactive_container">Interactive Container</h4>
<div class="paragraph">
<p>Typically container run in the background. They are launched and forgotten. And this is the default behaviour for Docker.
But there is a way we can make them behave like an instance with an interactive console.
To run the WildFly container in an interactive mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run -it jboss/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will show the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /opt/jboss/wildfly

  JAVA: /usr/lib/jvm/java/bin/java

  JAVA_OPTS:  -server -Xms64m -Xmx512m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true

=========================================================================

00:33:00,156 INFO  [org.jboss.modules] (main) JBoss Modules version 1.5.1.Final
00:33:00,587 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.6.Final
00:33:00,699 INFO  [org.jboss.as] (MSC service thread 1-2) WFLYSRV0049: WildFly Full 10.0.0.Final (WildFly Core 2.0.10.Final) starting
00:33:03,128 INFO  [org.jboss.as.server] (Controller Boot Thread) WFLYSRV0039: Creating http management service using socket-binding (management-http)
00:33:03,191 INFO  [org.xnio] (MSC service thread 1-2) XNIO version 3.3.4.Final
00:33:03,225 INFO  [org.xnio.nio] (MSC service thread 1-2) XNIO NIO Implementation Version 3.3.4.Final
00:33:03,382 INFO  [org.jboss.as.clustering.infinispan] (ServerService Thread Pool -- 38) WFLYCLINF0001: Activating Infinispan subsystem.
00:33:03,413 INFO  [org.wildfly.extension.io] (ServerService Thread Pool -- 37) WFLYIO001: Worker 'default' has auto-configured to 2 core threads with 16 task threads based on your 1 available processors
...
00:33:05,233 INFO  [org.wildfly.extension.undertow] (MSC service thread 1-2) WFLYUT0006: Undertow HTTP listener default listening on 0.0.0.0:8080
00:33:05,703 INFO  [org.jboss.ws.common.management] (MSC service thread 1-1) JBWS022052: Starting JBossWS 5.1.3.Final (Apache CXF 3.1.4)
00:33:05,868 INFO  [org.infinispan.factories.GlobalComponentRegistry] (MSC service thread 1-1) ISPN000128: Infinispan version: Infinispan 'Mahou' 8.1.0.Final
00:33:06,093 INFO  [org.jboss.as.server.deployment.scanner] (MSC service thread 1-2) WFLYDS0013: Started FileSystemDeploymentService for directory /opt/jboss/wildfly/standalone/deployments
00:33:06,265 INFO  [org.jboss.as.connector.subsystems.datasources] (MSC service thread 1-1) WFLYJCA0001: Bound data source [java:jboss/datasources/ExampleDS]
00:33:06,616 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0060: Http management interface listening on http://127.0.0.1:9990/management
00:33:06,630 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0051: Admin console listening on http://127.0.0.1:9990
00:33:06,630 INFO  [org.jboss.as] (Controller Boot Thread) WFLYSRV0025: WildFly Full 10.0.0.Final (WildFly Core 2.0.10.Final) started in 7052ms - Started 267 of 553 services (371 services are lazy, passive or on-demand)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that the server started correctly, congratulations!</p>
</div>
<div class="paragraph">
<p>The switches do the following: <code>-i</code> allows to interact with the STDIN and <code>-t</code> attach a TTY to the process. Switches can be combined together and used as <code>-it</code>.</p>
</div>
<div class="paragraph">
<p>Hit Ctrl+C to stop the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="_detached_container">Detached Container</h4>
<div class="paragraph">
<p>Restart the container in detached mode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name mywildfly -d jboss/wildfly
972f51cc8422eec0a7ea9a804a55a2827b5537c00a6bfd45f8646cb764bc002a</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-d</code>, instead of <code>-it</code>, runs the container in detached mode.</p>
</div>
<div class="paragraph">
<p>The output is the unique id assigned to the container. You can use it to refer to the container in various contexts. Check the logs as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker logs 972f51cc8422eec0a7ea9a804a55a2827b5537c00a6bfd45f8646cb764bc002a
=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /opt/jboss/wildfly

. . .</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can check it by issuing the <code>docker ps</code> command which retrieves the images process which are running and the ports engaged by the process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED              STATUS              PORTS               NAMES
7da1c7614edf        jboss/wildfly       &quot;/opt/jboss/wildfly/   About a minute ago   Up About a minute   8080/tcp            mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Noticed the "NAMES" column? This is a quick way of refering to your container. Let&#8217;s try to look at the logs again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker logs mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>That looks easier.</p>
</div>
<div class="paragraph">
<p>Also try <code>docker ps -a</code> to see all the containers on this machine.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_with_default_port">Run Container with Default Port</h3>
<div class="paragraph">
<p>Startup log of the server shows that the server is located in the <code>/opt/jboss/wildfly</code>. It also shows that the public interfaces are bound to the <code>0.0.0.0</code> address while the admin interfaces are bound just to <code>localhost</code>. This information will be useful to learn how to customize the server.</p>
</div>
<div class="paragraph">
<p><code>docker-machine ip &lt;machine-name&gt;</code> gives us the Docker Host IP address and this was already added to the hosts file. So, we can give it another try by accessing: <a href="http://dockerhost:8080" class="bare">http://dockerhost:8080</a>. However, this will not work either.</p>
</div>
<div class="paragraph">
<p>If you want containers to accept incoming connections, you will need to provide special options when invoking <code>docker run</code>. The container, we just started, can&#8217;t be accessed by our browser. We need to stop it again and restart with different options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop mywildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name mywildfly-exposed-ports -d -P jboss/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-P</code> map any exposed ports inside the image to a random port on the Docker host. This can be verified as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                     NAMES
7f41a5a0cfd6        jboss/wildfly      &quot;/opt/jboss/wildfly/   52 seconds ago      Up 52 seconds       0.0.0.0:32768-&gt;8080/tcp   mywildfly-exposed-ports</code></pre>
</div>
</div>
<div class="paragraph">
<p>The port mapping is shown in the <code>PORTS</code> column. Access the WildFly server at <a href="http://&lt;external-ip&gt;:32768" class="bare">http://&lt;external-ip&gt;:32768</a>. Make sure to use the correct port number as shown in your case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">External IP</div>
<div class="paragraph">
<p>Check the External IP in Compute → Compute Engine → VM Instances</p>
</div>
<div class="paragraph">
<p>Exact port number may be different in your case.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_run_container_with_specified_port">Run Container with Specified Port</h3>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop mywildfly-exposed-ports</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name mywildfly-mapped-ports -d -p 8080:8080 jboss/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>The format is <code>-p hostPort:containerPort</code>. This option maps container ports to host ports and allows other containers on our host to access them.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Docker Port Mapping</div>
<div class="paragraph">
<p>Port exposure and mapping are the keys to successful work with Docker.
See more about networking on the Docker website <a href="https://docs.docker.com/articles/networking/">Advanced Networking</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we&#8217;re ready to test <a href="http://&lt;external-ip&gt;:8080" class="bare">http://&lt;external-ip&gt;:8080</a> again. This works with the exposed port, as expected.</p>
</div>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop mywildfly-mapped-ports</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/plain-wildfly1.png" alt="plain wildfly1">
</div>
<div class="title">Figure 3. Welcome WildFly</div>
</div>
</div>
<div class="sect2">
<h3 id="_stop_container">Stop Container</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop a specific container:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop &lt;CONTAINER ID&gt;</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop all the running containers</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop $(docker ps -q)</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop only the exited containers</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps -a -f &quot;exited=-1&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_remove_container">Remove Container</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove a specific container:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker rm 0bc123a8ece0</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove containers meeting a regular expression</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove all containers, without any criteria</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker rm $(docker ps -aq)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_WildFly_Administration">Enabling WildFly Administration</h3>
<div class="paragraph">
<p>Default WildFly image exposes only port 8080 and thus is not available for administration using either the CLI or Admin Console. Lets expose the ports in different ways.</p>
</div>
<div class="sect3">
<h4 id="_default_port_mapping">Default Port Mapping</h4>
<div class="paragraph">
<p>Accessing WildFly Administration Console require a user in administration realm. A [pre-created](<a href="https://hub.docker.com/r/rafabene/wildfly-admin/~/dockerfile/" class="bare">https://hub.docker.com/r/rafabene/wildfly-admin/~/dockerfile/</a>) image, with appropriate username/password credentials, is used to start WildFly as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name managed-wildfly-from-image -P -d rafabene/wildfly-admin</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-P</code> map any exposed ports inside the image to a random port on Docker host.</p>
</div>
<div class="paragraph">
<p>Look at the exposed ports as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker ps
CONTAINER ID        IMAGE                       COMMAND                CREATED             STATUS              PORTS                                                       NAMES
5fdedef5573b        rafabene/wildfly-admin      &quot;/bin/sh -c '/opt/jb   15 seconds ago      Up 15 seconds       0.0.0.0:32772-&gt;8080/tcp, 0.0.0.0:32771-&gt;9990/tcp   managed-wildfly-from-image
ee30433b5414        jboss/wildfly               &quot;/opt/jboss/wildfly/   59 seconds ago      Up 59 seconds       0.0.0.0:32769-&gt;8080/tcp                            managed-wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Look for the host port that is mapped in the container, <code>32769</code> in this case. Access the admin console at <a href="http://&lt;external-ip&gt;:32769" class="bare">http://&lt;external-ip&gt;:32769</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Exact port number may be different in your case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The username/password credentials are:</p>
</div>
<table id="WildFly_Administration_Credentials" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">docker#admin</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This shows the admin console as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/wildfly-admin-console.png" alt="wildfly admin console">
</div>
<div class="title">Figure 4. Welcome WildFly</div>
</div>
<div class="sect4">
<h5 id="_additional_ways_to_find_port_mapping">Additional Ways To Find Port Mapping</h5>
<div class="paragraph">
<p>The exact mapped port can also be found as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>docker port</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker port managed-wildfly-from-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>to see the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">0.0.0.0:32769-&gt;8080/tcp
0.0.0.0:32770-&gt;9990/tcp</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using <code>docker inspect</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker inspect --format='{{(index (index .NetworkSettings.Ports &quot;9990/tcp&quot;) 0).HostPort}}' managed-wildfly-from-image</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Management_Fixed_Port_Mapping">Fixed Port Mapping</h4>
<div class="paragraph">
<p>This management image can also be started with a pre-defined port mapping as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run -p 8080:8080 -p 9990:9990 -d rafabene/wildfly-admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, Docker port mapping will be shown as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">8080/tcp -&gt; 0.0.0.0:8080
9990/tcp -&gt; 0.0.0.0:9990</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_an_image">Build an Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>PURPOSE</strong>: This chapter explains how to create a Docker image.</p>
</div>
<div class="paragraph">
<p>As explained in <a href="#Docker_Basics">Docker Basics</a>, Docker image is the <strong>build component</strong> of Docker and a read-only template of application operating system.</p>
</div>
<div class="sect2">
<h3 id="_dockerfile">Dockerfile</h3>
<div class="paragraph">
<p>Docker build images by reading instructions from a <em>Dockerfile</em>. A <em>Dockerfile</em> is a text document that contains all the commands a user could call on the command line to assemble an image. <code>docker build</code> command uses this file and executes all the commands in succession to create an image.</p>
</div>
<div class="paragraph">
<p><code>build</code> command is also passed a context that is used during image creation. This context can be a path on your local filesystem or a URL to a Git repository.</p>
</div>
<div class="paragraph">
<p><em>Dockerfile</em> is usually called <em>Dockerfile</em>. The complete list of commands that can be specified in this file are explained at <a href="https://docs.docker.com/reference/builder/" class="bare">https://docs.docker.com/reference/builder/</a>. The common commands are listed below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Common commands for Dockerfile</caption>
<colgroup>
<col style="width: 11%;">
<col style="width: 44%;">
<col style="width: 44%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">First non-comment instruction in <em>Dockerfile</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM ubuntu</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COPY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies mulitple source files from the context to the file system of the container at the specified path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COPY .bash_profile /home</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the environment variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ENV HOSTNAME=test</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RUN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes a command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RUN apt-get update</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CMD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults for an executing container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CMD ["/bin/echo", "hello world"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXPOSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Informs the network ports that the container will listen on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXPOSE 8093</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_create_your_first_docker_image">Create your first Docker image</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new directory 'helloworld' and "cd" into it.</p>
</li>
<li>
<p>Create a new text file, name it <em>Dockerfile</em>, and use the following contents:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">FROM fedora

CMD [&quot;/bin/echo&quot;, &quot;hello world&quot;]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This image uses <code>fedora</code> as the base image. <code>CMD</code> command defines the command that needs to run. It provides a different entry point of <code>/bin/echo</code> and gives the argument &#8220;hello world&#8221;.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build this image:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ docker build -t helloworld .
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM fedora
latest: Pulling from library/fedora
369aca82a5c0: Pull complete
a887c7ad7f3f: Pull complete
Digest: sha256:a220110e096cd1d6034699a5e30a012de6c55c83149d01658120918d01f1587a
Status: Downloaded newer image for fedora:latest
 ---&gt; a887c7ad7f3f
Step 2 : CMD /bin/echo hello world
 ---&gt; Running in 47e65a18749c
 ---&gt; 405849ed68f1
Removing intermediate container 47e65a18749c
Successfully built 405849ed68f1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>.</code> in this command is the context for <code>docker build</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List the images available:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
helloworld          latest              405849ed68f1        18 seconds ago      204.3 MB
fedora              latest              a887c7ad7f3f        6 days ago          204.3 MB</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the container:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>$  docker run -it helloworld</p>
</div>
<div class="paragraph">
<p>to see the output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>hello world</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the base image from <code>fedora</code> to <code>busybox</code> in <code>Dockerfile</code>. Build the image again:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>$  docker build -t helloworld2 .</p>
</div>
<div class="paragraph">
<p>and view the images as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE
helloworld2         latest              3dece940fa4a        6 seconds ago        1.109 MB
helloworld          latest              405849ed68f1        About a minute ago   204.3 MB
fedora              latest              a887c7ad7f3f        6 days ago           204.3 MB
busybox             latest              c51f86c28340        8 days ago           1.109 MB</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wildfly_image">WildFly Image</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new directory.</p>
</li>
<li>
<p>Create a new text file, name it <em>Dockerfile</em>, and use the following contents:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">FROM jboss/wildfly</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build the image:</p>
<div class="literalblock">
<div class="content">
<pre>$  docker build -t mywildfly .</pre>
</div>
</div>
</li>
<li>
<p>Run the container:</p>
<div class="literalblock">
<div class="content">
<pre>$  docker run -it mywildfly</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_import_and_export_images">Import and export images</h3>
<div class="paragraph">
<p>Docker images can be saved using <code>save</code> command to a .tar file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$  docker save helloworld &gt; helloworld.tar</pre>
</div>
</div>
<div class="paragraph">
<p>These tar files can then be imported using <code>load</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$  docker load -i helloworld.tar</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JavaEE_PreBuilt_WAR">Deploy Java EE Application (Pre-Built WAR)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/jboss-developer/ticket-monster">Ticket Monster</a> is a moderately complex application that demonstrates how to build modern applications using JBoss web technologies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/ticketmonster-architecture.png" alt="ticketmonster architecture">
</div>
<div class="title">Figure 5. Ticket Monster Architecture</div>
</div>
<div class="paragraph">
<p>Pull the Docker image that contains WildFly and pre-built Java EE application WAR file as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker pull rafabene/wildfly-ticketmonster-h2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/redhat-developer/docker-java/blob/devnexus2016/instructor/dockerfiles/wildfly-ticketmonster-h2/Dockerfile">wildfly-ticketmonster-h2 Dockerfile</a> is based on <code>jboss/wildfly</code> and adds the Ticket Monster application as war file.</p>
</div>
<div class="paragraph">
<p>Run it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run -it -p 8080:8080 rafabene/wildfly-ticketmonster-h2</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the application in action at <a href="http://&lt;external-ip&gt;:8080/ticket-monster/" class="bare">http://&lt;external-ip&gt;:8080/ticket-monster/</a>. The output is shown:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It might take a while for the container to come up. Wait for the server to complete the startup.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee-ticketmonster.png" alt="javaee ticketmonster">
</div>
<div class="title">Figure 6. Java EE Application Output</div>
</div>
<div class="paragraph">
<p>This uses an in-memory database with WildFly application server as shown in the image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-hol-in-memory-database.png" alt="javaee7 hol in memory database">
</div>
<div class="title">Figure 7. In-memory Database</div>
</div>
<div class="paragraph">
<p>Only one change were required to the standard <code>jboss/wildfly</code> image:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>WAR file is copied to the <code>standalone/deployments</code> directory as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">ADD ticket-monster.war /opt/jboss/wildfly/standalone/deployments/</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JavaEE_Docker_Network">Deploy Java EE  Application (Docker Network)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#JavaEE_PreBuilt_WAR">Deploy Java EE Application (Pre-Built WAR)</a> explained how to use an in-memory database with the application server. This gets you started rather quickly but becomes a bottleneck soon as the database is only in-memory. This means that any changes made to your schema and data are lost when the application server shuts down. In this case, you need to use a database server that resides outside the application server. For example, PostgreSQL as the database server and WildFly as the application server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee7-hol-container-linking.png" alt="javaee7 hol container linking">
</div>
<div class="title">Figure 8. Two Containers On Same Docker Host</div>
</div>
<div class="paragraph">
<p>This section will show how <a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/">Docker Networks</a> can be used to connect to a service running inside a Docker container via docker network.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a docker network as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker network create mynet</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start PostgreSQL server as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name db -d -p 5432:5432 --net mynet -e POSTGRES_USER=ticketmonster -e POSTGRES_PASSWORD=ticketmonster-docker postgres</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-e</code> define environment variables that are read by the database at startup and allow us to access the database with this user and password.</p>
</div>
<div class="paragraph">
<p><code>--net</code> defines the network which the container will use.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start WildFly with the deployed Java EE application as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run -d --name wildfly-ticketmonster --net mynet -p 8080:8080 rafabene/wildfly-ticketmonster</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>--net</code> is used again to define the network which the container will use. In this case this container will use the same network of PostgreSQL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Docker network</div>
<div class="paragraph">
<p>Docker 1.9 introduced the concept of multi-host networks. With the introduction of docker networks, docker linking is expected to be deprecated and removed in a future release.</p>
</div>
<div class="paragraph">
<p>Docker networks allows you to create virtual networks and attach container to them so you can create the network topology that is right for your application.</p>
</div>
<div class="paragraph">
<p>In our case, the WildFly container can see information about PostgreSQL . Once they are on the same network, the <code>/etc/hosts</code> files of both containers were updated to include information about other containers in the same network</p>
</div>
<div class="paragraph">
<p>See more about docker networks on the <a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/">Docker Networks</a> website.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the application in action at <a href="http://&lt;external-ip&gt;:8080/ticket-monster/" class="bare">http://&lt;external-ip&gt;:8080/ticket-monster/</a>. The output is shown:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It might take a while for the container to come up. Wait for the server to complete the startup.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/images/javaee-ticketmonster.png" alt="javaee ticketmonster">
</div>
<div class="title">Figure 9. Java EE Application Output</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you get a 404 or any other error, wait for a little longer until the containers are started up.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets stop the previously running container as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker stop db wildfly-ticketmonster
docker rm db wildfly-ticketmonster</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_and_deploy_java_ee_application">Build and Deploy Java EE Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you learned a lot about images, containers and how to link them together, it is about time to learn about the different deployment options. Let&#8217;s start over with the Ticket Monster applications again.
<a href="https://github.com/jboss-developer/ticket-monster">Ticket Monster</a> is a moderately complex application that demonstrates how to build modern applications using JBoss web technologies.</p>
</div>
<div class="sect2">
<h3 id="Build_Application">Build Application</h3>
<div class="paragraph">
<p>We&#8217;re going to build the application first.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the repo:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ cd /root

$ git clone https://github.com/jboss-developer/ticket-monster.git</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Build the application:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$  cd ticket-monster/demo

$  mvn clean package</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_application_server">Start Application Server</h3>
<div class="paragraph">
<p>Create a folder to place the deployments and give it write access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ mkdir /deployments
$ chmod 777 /deployments
$ chcon -Rt svirt_sandbox_file_t /deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start WildFly server as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name wildfly -d -p 8080:8080 -v /deployments:/opt/jboss/wildfly/standalone/deployments/:rw jboss/wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command starts a container named &#8220;wildfly&#8221;.</p>
</div>
<div class="paragraph">
<p>The <code>-v</code> flag maps a directory from the host into the container. This will be the directory to put the deployments. <code>rw</code> ensures that the Docker container can write to it.</p>
</div>
<div class="paragraph">
<p>Check logs to verify if the server has started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker logs -f wildfly</code></pre>
</div>
</div>
<div class="paragraph">
<p>Access <a href="http://&lt;external-ip&gt;:8080" class="bare">http://&lt;external-ip&gt;:8080</a> in your browser to make sure the instance is up and running.</p>
</div>
<div class="paragraph">
<p>Now you&#8217;re ready to deploy the application for the first time.</p>
</div>
<div class="paragraph">
<p>Copy the geneated WAR to your deploy folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ cp target/ticket-monster.war /deployments</code></pre>
</div>
</div>
<div class="paragraph">
<p>Congratulations!</p>
</div>
<div class="paragraph">
<p>You&#8217;ve deployed your first application to WildFly running in a Docker container from JBoss Developer Studio. You can check it by looking in the logs or accessing <a href="http://&lt;external-ip&gt;:8080/ticket-monster/" class="bare">http://&lt;external-ip&gt;:8080/ticket-monster/</a></p>
</div>
<div class="paragraph">
<p>Stop WildFly container when you&#8217;re done.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ docker stop wildfly
$ docker rm wildfly</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_application_using_cli">Deploy Application Using CLI</h3>
<div class="sect3">
<h4 id="_wildfly">WildFly</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download WildFly 10.0.0.Final from Internet: <a href="http://download.jboss.org/wildfly/10.0.0.Final/wildfly-10.0.0.Final.zip" class="bare">http://download.jboss.org/wildfly/10.0.0.Final/wildfly-10.0.0.Final.zip</a> .</p>
</li>
<li>
<p>Install it by extracting the archive.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ cd /root
$ wget http://download.jboss.org/wildfly/10.0.0.Final/wildfly-10.0.0.Final.zip
$ unzip wildfly-10.0.0.Final.zip
$ cd wildfly-10.0.0.Final/bin/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cli">CLI</h4>
<div class="paragraph">
<p>The Command Line Interface (CLI) is a tool for connecting to WildFly instances to manage all tasks from command line environment. Some of the tasks that you can do using the CLI are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy/Undeploy web application in standalone/Domain Mode.</p>
</li>
<li>
<p>View all information about the deployed application on runtime.</p>
</li>
<li>
<p>Start/Stop/Restart Nodes in respective mode i.e. Standalone/Domain.</p>
</li>
<li>
<p>Adding/Deleting resource or subsystems to servers.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Lets use the CLI to deploy ticket-monster to WildFly running in the container.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CLI needs to be locally installed and comes as part of WildFly.</p>
</li>
<li>
<p>Run the &#8220;wildfly-management&#8221; image with fixed port mapping as explained in <a href="#Management_Fixed_Port_Mapping">Fixed Port Mapping</a>.</p>
</li>
<li>
<p>Run the <code>jboss-cli</code> command and connect to the WildFly instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Start WildFly server as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker run --name wildfly-managed -d -p 8080:8080 -p 9990:9990 rafabene/wildfly-admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command starts a container named &#8220;wildfly-managed&#8221;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ ./jboss-cli.sh --controller='localhost:9990'  -u='admin' -p='docker#admin' -c</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will show the output as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">[standalone@localhost:9990 /]</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploy the application as:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">deploy /root/ticket-monster/demo/target/ticket-monster.war --force

exit</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop Wildfly</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker stop wildfly-managed
$ docker rm wildfly-managed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you&#8217;ve sucessfully used the CLI to remote deploy the Ticket Monster application to WildFly running as docker container.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Common_Docker_Commands">Common Docker Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is the list of commonly used Docker commands:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Image</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker build --rm=true .</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker pull ${IMAGE}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of installed images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker images</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of installed images (detailed listing)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker images --no-trunc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove an image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi ${IMAGE_ID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all untagged images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi $(docker images | grep “^” | awk “{print $3}”)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm $(docker ps -aq)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove dangling images</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rmi $(docker images --quiet --filter "dangling=true")</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Containers</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker run</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of running containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of all containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker stop ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stop all running containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker stop <code>docker ps -q</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List all exited containers with status 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a --filter "exited=1"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove container by a regular expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps -a | grep wildfly | awk '{print $1}' | xargs docker rm -f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all exited containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm -f $(docker ps -a | grep Exit | awk '{ print $1 }')</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove all containers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker rm $(docker ps -aq)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find IP address of the container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker inspect --format '{{ .NetworkSettings.IPAddress }}' ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attach to a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker attach ${CID}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open a shell in to a container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker exec -it ${CID} bash</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Get container id for an image by a regular expression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docker ps | grep wildfly | awk '{print $1}'</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting">Troubleshooting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_can_t_resolve_classroom_example_com">Can&#8217;t resolve classroom.example.com</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure to add the instructor IP as DNS server to your system</p>
</li>
<li>
<p>On Windows temporarily disable IPv6 (we&#8217;re only supporting IPv4)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_network_timed_out">Network Timed Out</h3>
<div class="paragraph">
<p>Depending upon the network speed and restrictions, you may not be able to download Docker images from Docker Hub. The error message may look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ docker pull arungupta/wildfly-mysql-javaee7
Using default tag: latest
Pulling repository docker.io/arungupta/wildfly-mysql-javaee7
Network timed out while trying to connect to https://index.docker.io/v1/repositories/arungupta/wildfly-mysql-javaee7/images. You may want to check your internet connection or if you are behind a proxy.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This section provide a couple of alternatives to solve this.</p>
</div>
<div class="sect3">
<h4 id="_restart_docker_machine">Restart Docker Machine</h4>
<div class="paragraph">
<p>It seems like Docker Machine gets into a strange state and restarting it fixes that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker-machine restart &lt;MACHINE_NAME&gt;
eval $(docker-machine env &lt;MACHINE_NAME&gt;)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_loading_images_offline">Loading Images Offline</h4>
<div class="paragraph">
<p>Images can be downloaded from a previously saved <code>.tar</code> file. All images required for this workshop can be downloaded from:</p>
</div>
<div class="paragraph">
<p><a href="https://drive.google.com/folderview?id=0B8g4lYJ4uB37RkdqbFpPZU5ZS2s&amp;usp=sharing" class="bare">https://drive.google.com/folderview?id=0B8g4lYJ4uB37RkdqbFpPZU5ZS2s&amp;usp=sharing</a></p>
</div>
<div class="paragraph">
<p>Load the tar file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker load -i &lt;path to image tar file&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">docker load -i arungupta-javaee7-hol.tar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now <code>docker images</code> should show the image.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cannot_create_docker_machine_on_windows">Cannot create Docker Machine on Windows</h3>
<div class="paragraph">
<p>Double check, that you have the correct version of VirtualBox installed.
Clear all host-adapter interfaces in Virtualbox before creating a new machine.
Make sure to have git for windows in your path.</p>
</div>
<div class="paragraph">
<p>Are you not able to create Docker Machine on Windows?</p>
</div>
<div class="paragraph">
<p>Try starting a <code>cmd</code> with Administrator privileges and then give the command again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_no_route_to_host">No route to host</h3>
<div class="paragraph">
<p>Accessing the WildFly and MySQL sample in Kubernetes gives 404 when you give the command <code>curl <a href="http://10.246.1.23:8080/employees/resources/employees/" class="bare">http://10.246.1.23:8080/employees/resources/employees/</a></code>.</p>
</div>
<div class="paragraph">
<p>This may be resolved by stopping the node and restarting the cluster again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">vagrant halt minion-1
./cluster/kube-up.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>These commands need to be given in the &#8216;kubernetes&#8217; directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_docker_machine_creation_fails_with_an_error_about_dial_tcp_i_o_timeout">Docker machine creation fails with an error about dial tcp: i/o timeout</h3>
<div class="paragraph">
<p>If you get the following error when creating a docker machine</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Error creating machine: Error in driver during machine creation: Get https://api.github.com/repos/boot2docker/boot2docker/releases: dial tcp: i/o timeout</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you need to go to the boot2docker releases page on</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/boot2docker/boot2docker/releases" class="bare">https://github.com/boot2docker/boot2docker/releases</a></p>
</div>
<div class="paragraph">
<p>And download the latest .iso</p>
</div>
<div class="paragraph">
<p>After that you can move that iso to the docker cache directory. This is located in <code>~/.docker/machine/cache</code> on Mac &amp; Linux and <code>/Users/yourUserName/.docker/machine/cache</code> on Windows.</p>
</div>
<div class="paragraph">
<p>Issue: <a href="https://github.com/docker/machine/issues/2186" class="bare">https://github.com/docker/machine/issues/2186</a> is raised so that the docker-machine team can hopefully find a way around this.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Docker Docs: <a href="http://docs.docker.com" class="bare">http://docs.docker.com</a></p>
</li>
<li>
<p>Kubernetes Docs: <a href="https://github.com/kubernetes/kubernetes/tree/master/docs" class="bare">https://github.com/kubernetes/kubernetes/tree/master/docs</a></p>
</li>
<li>
<p>JBoss and Docker: <a href="http://www.jboss.org/docker/" class="bare">http://www.jboss.org/docker/</a></p>
</li>
<li>
<p>Ticket Monster: <a href="http://www.jboss.org/ticket-monster/" class="bare">http://www.jboss.org/ticket-monster/</a></p>
</li>
<li>
<p>Latest lab content: <a href="https://github.com/redhat-developer/docker-java/" class="bare">https://github.com/redhat-developer/docker-java/</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-02-13 17:27:36 EST
</div>
</div>
</body>
</html>